{"version":3,"sources":["index.js"],"names":["LogOut","props","state","initialState","logOut","bind","isBrowser","client","resetStore","error","console","Promise","resolve","reject","fetch","ENDPOINT_CLIENT","method","credentials","mode","headers","Accept","then","response","removeUser","setState","redirect","Component","ReactRoutePropTypes","staticContex","PropTypes","any","dispatch","func","user","type","USER_REMOVE"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;IAEaA,M;;;;;AAaX,kBAAYC,KAAZ,EAAmB;AAAA;;AAAA;AACjB,kHAAMA,KAAN;AACA,UAAKC,KAAL,GAAa,MAAKC,YAAlB;AACA,UAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYC,IAAZ,gDAAd;;AACA,UAAKD,MAAL;;AAJiB;AAKlB;;;;6BAOQ;AAAA;;AACP,UAAIE,SAAJ,EAAe;AACb,YAAI;AACF,eAAKL,KAAL,CAAWM,MAAX,CAAkBC,UAAlB;AACD,SAFD,CAEE,OAAOC,KAAP,EAAc;AACd,4CAAiBA,KAAjB;AACAC,UAAAA,OAAO,CAACD,KAAR,CAAc,+BAAd,EAA+CA,KAA/C;AACD;;AACD,eAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCC,UAAAA,KAAK,WAAIC,eAAJ,mBAAmC;AACtCC,YAAAA,MAAM,EAAE,MAD8B;AAEtCC,YAAAA,WAAW,EAAE,SAFyB;AAGtCC,YAAAA,IAAI,EAAE,SAHgC;AAItCC,YAAAA,OAAO,EAAE;AACPC,cAAAA,MAAM,EAAE,iDADD;AAEP,8BAAgB;AAFT;AAJ6B,WAAnC,CAAL,CASGC,IATH,CASQ,UAAAC,QAAQ,EAAI;AAChB,YAAA,MAAI,CAACrB,KAAL,CAAWsB,UAAX;;AACA,YAAA,MAAI,CAACC,QAAL,CAAc;AAAA,qBAAO;AACnBC,gBAAAA,QAAQ,EAAE;AADS,eAAP;AAAA,aAAd;;AAGAb,YAAAA,OAAO,CAACU,QAAD,CAAP;AACD,WAfH,WAgBS,UAAAb,KAAK,EAAI;AACd,8CAAiBA,KAAjB,EAAuB,gBAAvB;;AACA,YAAA,MAAI,CAACR,KAAL,CAAWsB,UAAX;;AACA,YAAA,MAAI,CAACC,QAAL,CAAc;AAAA,qBAAO;AACnBC,gBAAAA,QAAQ,EAAE;AADS,eAAP;AAAA,aAAd;;AAGAZ,YAAAA,MAAM,CAACJ,KAAD,CAAN;AACD,WAvBH;AAwBD,SAzBM,CAAP;AA0BD;AACF;;;6BAEQ;AAAA,UACCgB,QADD,GACc,KAAKvB,KADnB,CACCuB,QADD;;AAGP,UAAIA,QAAJ,EAAc;AACZ,eAAO,gCAAC,wBAAD;AAAU,UAAA,EAAE,EAAEA;AAAd,UAAP;AACD;;AACD,aAAO,gCAAC,0BAAD,OAAP;AACD;;;wBAjDkB;AACjB,aAAO;AACLA,QAAAA,QAAQ,EAAE;AADL,OAAP;AAGD;;;EAxByBC,gB;;;iCAAf1B,M,kDAEN2B,wC;AACH;AACA;;AACA;AACAC,EAAAA,YAAY,EAAEC,sBAAUC,G;;AACxB;AACAC,EAAAA,QAAQ,EAAEF,sBAAUG,I,CACpB;AACA;;;AA6DJ,iBAAAhC,MAAM,GAAG,yBACP,UAAAE,KAAK;AAAA,SAAK;AACR+B,IAAAA,IAAI,EAAE,iCAAiB/B,KAAjB;AADE,GAAL;AAAA,CADE,EAIP,UAAA6B,QAAQ;AAAA,SAAK;AACXR,IAAAA,UAAU,EAAE;AAAA,aAAMQ,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAEC;AAAR,OAAD,CAAd;AAAA;AADD,GAAL;AAAA,CAJD,EAOPnC,MAPO,CAAT;AASA,iBAAAA,MAAM,GAAG,6BAAWA,MAAX,CAAT;eACeA,M","sourcesContent":["import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Redirect } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport { USER_REMOVE } from '../../../../store/reducers/user/actionTypes';\r\n\r\nimport { ReactRoutePropTypes } from '../../../../propTypes/ReactRoutePropTypes';\r\nimport { getUserFromStore } from '../../../../store/reducers/user/selectors';\r\nimport SmallPreloader from '../../../../components/SmallPreloader/SmallPreloader';\r\nimport { withApollo } from 'react-apollo';\r\nimport { captureException } from '../../../../hocs/withSentry/withSentry';\r\n\r\nexport class LogOut extends Component {\r\n  static propTypes = {\r\n    ...ReactRoutePropTypes,\r\n    // /** react-localize-redux/lib/index */\r\n    // translate: PropTypes.func,\r\n    /**  */\r\n    staticContex: PropTypes.any,\r\n    /** func redux */\r\n    dispatch: PropTypes.func,\r\n    // /** language */\r\n    // currentLanguage: PropTypes.string,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = this.initialState;\r\n    this.logOut = this.logOut.bind(this);\r\n    this.logOut();\r\n  }\r\n\r\n  get initialState() {\r\n    return {\r\n      redirect: null,\r\n    };\r\n  }\r\n  logOut() {\r\n    if (isBrowser) {\r\n      try {\r\n        this.props.client.resetStore();\r\n      } catch (error) {\r\n        captureException(error);\r\n        console.error('Error reset store in logout: ', error);\r\n      }\r\n      return new Promise((resolve, reject) => {\r\n        fetch(`${ENDPOINT_CLIENT}/user/logout`, {\r\n          method: 'POST',\r\n          credentials: 'include',\r\n          mode: 'no-cors',\r\n          headers: {\r\n            Accept: 'text/html,application/xhtml+xml,application/xml',\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n          },\r\n        })\r\n          .then(response => {\r\n            this.props.removeUser();\r\n            this.setState(() => ({\r\n              redirect: '/login',\r\n            }));\r\n            resolve(response);\r\n          })\r\n          .catch(error => {\r\n            captureException(error,'Error logout: ');\r\n            this.props.removeUser();\r\n            this.setState(() => ({\r\n              redirect: '/login',\r\n            }));\r\n            reject(error);\r\n          });\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { redirect } = this.state;\r\n\r\n    if (redirect) {\r\n      return <Redirect to={redirect} />;\r\n    }\r\n    return <SmallPreloader />;\r\n  }\r\n}\r\nLogOut = connect(\r\n  state => ({\r\n    user: getUserFromStore(state),\r\n  }),\r\n  dispatch => ({\r\n    removeUser: () => dispatch({ type: USER_REMOVE }),\r\n  }),\r\n)(LogOut);\r\n\r\nLogOut = withApollo(LogOut);\r\nexport default LogOut;\r\n"]}