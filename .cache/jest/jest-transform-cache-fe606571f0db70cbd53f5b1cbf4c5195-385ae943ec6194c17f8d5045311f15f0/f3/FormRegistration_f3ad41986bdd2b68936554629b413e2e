035bf7c1442fe6ebf117c3d37fec3414
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.FormRegistration = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactRedux = require("react-redux");

var _reactRouterDom = require("react-router-dom");

var _reactApollo = require("react-apollo");

var _reactNotificationSystemRedux = require("react-notification-system-redux");

var _reduxForm = require("redux-form");

var _withSentry = require("../../../../hocs/withSentry/withSentry");

var _Box = _interopRequireDefault(require("@lib/ui/Box/Box"));

var _TooltipBase = _interopRequireDefault(require("@lib/ui/TooltipBase/TooltipBase"));

var _FormButtonSubmit = _interopRequireDefault(require("@lib/ui/FormButtonSubmit/FormButtonSubmit"));

var _TextFieldWithTooltip = _interopRequireDefault(require("@lib/ui/TextFieldWithTooltip/TextFieldWithTooltip"));

var _TextFieldLastWrapper = require("@lib/ui/TextFieldLastWrapper/TextFieldLastWrapper");

var _TextFieldFirstWrapper = require("@lib/ui/TextFieldFirstWrapper/TextFieldFirstWrapper");

var _FormLogo = _interopRequireDefault(require("../FormLogo/FormLogo"));

var _FieldInputPassword = _interopRequireDefault(require("../FieldInputPassword/FieldInputPassword"));

var _FetchUserAuth = require("../FetchUserAuth/FetchUserAuth");

var _FormPropTypes = require("../../../../propTypes/Forms/FormPropTypes");

var _ActivateUserMutation = _interopRequireDefault(require("./ActivateUserMutation.graphql"));

var _CurrentUserItemQuery = _interopRequireDefault(require("./CurrentUserItemQuery.graphql"));

var _isEmail = _interopRequireDefault(require("../../../../utils/validation/isEmail"));

var _required = _interopRequireDefault(require("../../../../utils/validation/required"));

var _actionTypes = require("../../../../store/reducers/user/actionTypes");

/** View */

/** Components */

/** PropTypes */

/** GraphQL schema */

/** Validation */

/** Constatnts */
var validate = function validate(_ref) {
  var email = _ref.email,
      password = _ref.password,
      retryPas = _ref.retryPas;
  var errors = {};
  console.log('validate: ', email, password, retryPas);

  if (!email) {
    errors.email = 'Обязательно для заполнения';
  }

  if (!(0, _isEmail["default"])(errors.email)) {
    errors.email = (0, _isEmail["default"])(errors.email);
  }

  if (!password) {
    errors.password = 'Обязательно для заполнения';
  }

  if (!retryPas) {
    errors.retryPas = 'Обязательно для заполнения';
  }

  if (password !== undefined && password.length <= 7) {
    errors.password = 'Пароль должен состоять минимум из 8 символов';
  }

  if (password !== undefined && password.length >= 30) {
    errors.password = 'Пароль должен состоять не больше 30 символов';
  }

  if (password !== retryPas) {
    errors.retryPas = 'Пароли не совпадают';
  }

  return errors;
};

var notificationOpts = function notificationOpts() {
  return {
    success: {
      title: 'Пользователь успешно зарегистрирован',
      message: 'Пользователь успешно зарегистрирован',
      position: 'tr',
      autoDismiss: 2
    },
    error: {
      title: 'Пользователь не был зарегистрирован',
      message: 'Пользователь не был зарегистрирован',
      position: 'tr',
      autoDismiss: 2
    }
  };
};

var FormRegistration =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(FormRegistration, _Component);

  function FormRegistration(_props) {
    var _this;

    (0, _classCallCheck2["default"])(this, FormRegistration);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(FormRegistration).call(this, _props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getUser", function (email) {
      var _this$props = _this.props,
          client = _this$props.client,
          history = _this$props.history,
          setNotificationSuccess = _this$props.setNotificationSuccess,
          setNotificationError = _this$props.setNotificationError;
      return client.query({
        query: _CurrentUserItemQuery["default"],
        variables: {
          email: email
        }
      }).then(function (result) {
        if (result.errors || result.data.currentuseritem === null) {
          // TO DO change this
          throw result;
        } else {
          _this.setState(function () {
            return {
              apolloError: null,
              isLoading: false
            };
          });

          _this.setUser(result);

          history.push("/app/project-list");
          setNotificationSuccess(notificationOpts().success);
          return Promise.resolve(result);
        }
      })["catch"](function (_ref2) {
        var graphQLErrors = _ref2.graphQLErrors,
            message = _ref2.message,
            error = _ref2.error,
            networkError = _ref2.networkError,
            rest = (0, _objectWithoutProperties2["default"])(_ref2, ["graphQLErrors", "message", "error", "networkError"]);
        // console.log('graphQLErrors: ', graphQLErrors);
        // console.log('message: ', message);
        // console.log('networkError: ', networkError);
        // console.log('rest: ', rest);
        // console.log('error: ', error);
        setNotificationError(notificationOpts().error);

        _this.setState(function () {
          return {
            submitting: false,
            apolloError: 'Ошибка входа',
            isLoading: false
          };
        });
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setUser", function (props) {
      var currentuseritem = props.data.currentuseritem;
      var addUser = _this.props.addUser;
      addUser(currentuseritem);
      localStorage.setItem('user', JSON.stringify((0, _objectSpread2["default"])({}, currentuseritem)));
    });
    _this.state = _this.initialState;
    _this.submit = _this.submit.bind((0, _assertThisInitialized2["default"])(_this));
    return _this;
  }

  (0, _createClass2["default"])(FormRegistration, [{
    key: "userAuth",
    value: function userAuth(value) {
      var _this2 = this;

      return (0, _FetchUserAuth.FetchUserAuth)(value).then(function (response) {
        if (response.status >= 400 || !document.cookie) {
          throw response;
        } else {
          return _this2.getUser(value.uname);
        }
      })["catch"](function (error) {
        var status = error.status;

        _this2.setState(function () {
          return {
            submitting: false,
            isLoading: false,
            apolloError: null
          };
        });

        (0, _withSentry.captureException)(error);

        if (status === 401 || status === 403) {
          throw new _reduxForm.SubmissionError({
            _error: 'Не верно введен логин или пароль'
          });
        } else {
          throw new _reduxForm.SubmissionError({
            _error: 'Пользователь не найден'
          });
        }
      });
    }
  }, {
    key: "submit",
    value: function submit(value) {
      var _this3 = this;

      var data = {
        variables: Object.assign({}, value)
      };
      console.log(123, value);
      this.setState(function (_ref3) {
        var submitting = _ref3.submitting,
            isLoading = _ref3.isLoading;
        return {
          submitting: !submitting,
          isLoading: !isLoading
        };
      });
      return this.props['@apollo/create'](data).then(function (response) {
        if (response.errors) {
          throw response;
        } else {
          _this3.userAuth({
            uname: value.email,
            ups: value.password
          });

          return Promise.resolve(response);
        }
      })["catch"](function (error) {
        console.log(error);

        _this3.props.setNotificationError(notificationOpts().error);

        _this3.setState(function () {
          return {
            submitting: false,
            apolloError: 'Ошибка авторизации пользователя',
            isLoading: false
          };
        });
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          handleSubmit = _this$props2.handleSubmit,
          pristine = _this$props2.pristine,
          invalid = _this$props2.invalid,
          error = _this$props2.error;
      var _this$state = this.state,
          isLoading = _this$state.isLoading,
          apolloError = _this$state.apolloError,
          submitting = _this$state.submitting;
      console.log(pristine, submitting, invalid);
      return _react["default"].createElement(_reduxForm.Form, {
        onSubmit: handleSubmit(this.submit)
      }, _react["default"].createElement(_FormLogo["default"], null), _react["default"].createElement(_Box["default"], {
        mb: '100px'
      }, _react["default"].createElement(_TextFieldFirstWrapper.TextFieldFirstWrapper, null, _react["default"].createElement(_reduxForm.Field, {
        name: 'email',
        component: _TextFieldWithTooltip["default"],
        placeholder: 'Логин',
        type: "text",
        left: '40%'
      })), _react["default"].createElement(_reduxForm.Field, {
        name: 'password',
        placeholder: 'Пароль',
        variant: 'secondary',
        component: _FieldInputPassword["default"]
      }), _react["default"].createElement(_TextFieldLastWrapper.TextFieldLastWrapper, null, _react["default"].createElement(_reduxForm.Field, {
        name: 'retryPas',
        placeholder: 'Потвердите пароль',
        variant: 'secondary',
        component: _FieldInputPassword["default"]
      }))), _react["default"].createElement(_FormButtonSubmit["default"], {
        disabled: pristine || submitting || invalid,
        ml: 9,
        isLoading: isLoading,
        error: error || apolloError
      }, _react["default"].createElement(_TooltipBase["default"], {
        isActive: error,
        warning: error
      }, "\u0412\u043E\u0439\u0442\u0438")));
    }
  }, {
    key: "initialState",
    get: function get() {
      return {
        submitting: false,
        apolloError: null,
        isLoading: false
      };
    }
  }]);
  return FormRegistration;
}(_react.Component);

exports.FormRegistration = FormRegistration;
(0, _defineProperty2["default"])(FormRegistration, "propTypes", (0, _objectSpread2["default"])({}, _FormPropTypes.formPropTypes));
exports.FormRegistration = FormRegistration = (0, _reactRouterDom.withRouter)(FormRegistration);
exports.FormRegistration = FormRegistration = (0, _reactApollo.withApollo)(FormRegistration);
exports.FormRegistration = FormRegistration = (0, _reactApollo.graphql)(_ActivateUserMutation["default"], {
  name: '@apollo/create'
})(FormRegistration);
exports.FormRegistration = FormRegistration = (0, _reactRedux.connect)(function (state) {
  return {
    values: (0, _reduxForm.getFormValues)('FormRegistration')(state)
  };
}, function (dispatch) {
  return {
    addUser: function addUser(user) {
      return dispatch({
        type: _actionTypes.USER_ADD,
        user: user
      });
    },
    setNotificationSuccess: function setNotificationSuccess(message) {
      return dispatch((0, _reactNotificationSystemRedux.success)(message));
    },
    setNotificationError: function setNotificationError(message) {
      return dispatch((0, _reactNotificationSystemRedux.error)(message));
    }
  };
})(FormRegistration);
exports.FormRegistration = FormRegistration = (0, _reduxForm.reduxForm)({
  form: 'FormRegistration',
  validate: validate
})(FormRegistration);
var _default = FormRegistration; // validate={[required, isEmail]}

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZvcm1SZWdpc3RyYXRpb24uanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJlbWFpbCIsInBhc3N3b3JkIiwicmV0cnlQYXMiLCJlcnJvcnMiLCJjb25zb2xlIiwibG9nIiwidW5kZWZpbmVkIiwibGVuZ3RoIiwibm90aWZpY2F0aW9uT3B0cyIsInN1Y2Nlc3MiLCJ0aXRsZSIsIm1lc3NhZ2UiLCJwb3NpdGlvbiIsImF1dG9EaXNtaXNzIiwiZXJyb3IiLCJGb3JtUmVnaXN0cmF0aW9uIiwicHJvcHMiLCJjbGllbnQiLCJoaXN0b3J5Iiwic2V0Tm90aWZpY2F0aW9uU3VjY2VzcyIsInNldE5vdGlmaWNhdGlvbkVycm9yIiwicXVlcnkiLCJDdXJyZW50VXNlckl0ZW1RdWVyeSIsInZhcmlhYmxlcyIsInRoZW4iLCJyZXN1bHQiLCJkYXRhIiwiY3VycmVudHVzZXJpdGVtIiwic2V0U3RhdGUiLCJhcG9sbG9FcnJvciIsImlzTG9hZGluZyIsInNldFVzZXIiLCJwdXNoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJncmFwaFFMRXJyb3JzIiwibmV0d29ya0Vycm9yIiwicmVzdCIsInN1Ym1pdHRpbmciLCJhZGRVc2VyIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0ZSIsImluaXRpYWxTdGF0ZSIsInN1Ym1pdCIsImJpbmQiLCJ2YWx1ZSIsInJlc3BvbnNlIiwic3RhdHVzIiwiZG9jdW1lbnQiLCJjb29raWUiLCJnZXRVc2VyIiwidW5hbWUiLCJTdWJtaXNzaW9uRXJyb3IiLCJfZXJyb3IiLCJPYmplY3QiLCJhc3NpZ24iLCJ1c2VyQXV0aCIsInVwcyIsImhhbmRsZVN1Ym1pdCIsInByaXN0aW5lIiwiaW52YWxpZCIsIlRleHRGaWVsZFdpdGhUb29sdGlwIiwiRmllbGRJbnB1dFBhc3N3b3JkIiwiQ29tcG9uZW50IiwiZm9ybVByb3BUeXBlcyIsIkFjdGl2YXRlVXNlck11dGF0aW9uIiwibmFtZSIsInZhbHVlcyIsImRpc3BhdGNoIiwidXNlciIsInR5cGUiLCJVU0VSX0FERCIsImZvcm0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBR0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBR0E7O0FBekJBOztBQVFBOztBQUtBOztBQUdBOztBQUlBOztBQUlBO0FBR0EsSUFBTUEsUUFBUSxHQUFHLFNBQVhBLFFBQVcsT0FBbUM7QUFBQSxNQUFoQ0MsS0FBZ0MsUUFBaENBLEtBQWdDO0FBQUEsTUFBekJDLFFBQXlCLFFBQXpCQSxRQUF5QjtBQUFBLE1BQWZDLFFBQWUsUUFBZkEsUUFBZTtBQUNsRCxNQUFNQyxNQUFNLEdBQUcsRUFBZjtBQUNBQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxZQUFaLEVBQXlCTCxLQUF6QixFQUFnQ0MsUUFBaEMsRUFBMENDLFFBQTFDOztBQUNBLE1BQUksQ0FBQ0YsS0FBTCxFQUFZO0FBQ1ZHLElBQUFBLE1BQU0sQ0FBQ0gsS0FBUCxHQUFlLDRCQUFmO0FBQ0Q7O0FBQ0QsTUFBSSxDQUFDLHlCQUFRRyxNQUFNLENBQUNILEtBQWYsQ0FBTCxFQUE0QjtBQUMxQkcsSUFBQUEsTUFBTSxDQUFDSCxLQUFQLEdBQWUseUJBQVFHLE1BQU0sQ0FBQ0gsS0FBZixDQUFmO0FBQ0Q7O0FBRUQsTUFBSSxDQUFDQyxRQUFMLEVBQWU7QUFDYkUsSUFBQUEsTUFBTSxDQUFDRixRQUFQLEdBQWtCLDRCQUFsQjtBQUNEOztBQUVELE1BQUksQ0FBQ0MsUUFBTCxFQUFlO0FBQ2JDLElBQUFBLE1BQU0sQ0FBQ0QsUUFBUCxHQUFrQiw0QkFBbEI7QUFDRDs7QUFFRCxNQUFJRCxRQUFRLEtBQUtLLFNBQWIsSUFBMEJMLFFBQVEsQ0FBQ00sTUFBVCxJQUFtQixDQUFqRCxFQUFvRDtBQUNsREosSUFBQUEsTUFBTSxDQUFDRixRQUFQLEdBQWtCLDhDQUFsQjtBQUNEOztBQUVELE1BQUlBLFFBQVEsS0FBS0ssU0FBYixJQUEwQkwsUUFBUSxDQUFDTSxNQUFULElBQW1CLEVBQWpELEVBQXFEO0FBQ25ESixJQUFBQSxNQUFNLENBQUNGLFFBQVAsR0FBa0IsOENBQWxCO0FBQ0Q7O0FBRUQsTUFBSUEsUUFBUSxLQUFLQyxRQUFqQixFQUEyQjtBQUN6QkMsSUFBQUEsTUFBTSxDQUFDRCxRQUFQLEdBQWtCLHFCQUFsQjtBQUNEOztBQUVELFNBQU9DLE1BQVA7QUFDRCxDQS9CRDs7QUFpQ0EsSUFBTUssZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFtQjtBQUFBLFNBQU87QUFDOUJDLElBQUFBLE9BQU8sRUFBRTtBQUNQQyxNQUFBQSxLQUFLLEVBQUUsc0NBREE7QUFFUEMsTUFBQUEsT0FBTyxFQUFFLHNDQUZGO0FBR1BDLE1BQUFBLFFBQVEsRUFBRSxJQUhIO0FBSVBDLE1BQUFBLFdBQVcsRUFBRTtBQUpOLEtBRHFCO0FBTzlCQyxJQUFBQSxLQUFLLEVBQUU7QUFDTEosTUFBQUEsS0FBSyxFQUFFLHFDQURGO0FBRUxDLE1BQUFBLE9BQU8sRUFBRSxxQ0FGSjtBQUdMQyxNQUFBQSxRQUFRLEVBQUUsSUFITDtBQUlMQyxNQUFBQSxXQUFXLEVBQUU7QUFKUjtBQVB1QixHQUFQO0FBQUEsQ0FBekI7O0lBZWFFLGdCOzs7OztBQUtYLDRCQUFZQyxNQUFaLEVBQW1CO0FBQUE7O0FBQUE7QUFDakIsNEhBQU1BLE1BQU47QUFEaUIsZ0dBa0NULFVBQUFoQixLQUFLLEVBQUk7QUFBQSx3QkFDeUQsTUFBS2dCLEtBRDlEO0FBQUEsVUFDVEMsTUFEUyxlQUNUQSxNQURTO0FBQUEsVUFDREMsT0FEQyxlQUNEQSxPQURDO0FBQUEsVUFDUUMsc0JBRFIsZUFDUUEsc0JBRFI7QUFBQSxVQUNnQ0Msb0JBRGhDLGVBQ2dDQSxvQkFEaEM7QUFFakIsYUFBT0gsTUFBTSxDQUNWSSxLQURJLENBQ0U7QUFBRUEsUUFBQUEsS0FBSyxFQUFFQyxnQ0FBVDtBQUErQkMsUUFBQUEsU0FBUyxFQUFFO0FBQUV2QixVQUFBQSxLQUFLLEVBQUVBO0FBQVQ7QUFBMUMsT0FERixFQUVKd0IsSUFGSSxDQUVDLFVBQUFDLE1BQU0sRUFBSTtBQUNkLFlBQUlBLE1BQU0sQ0FBQ3RCLE1BQVAsSUFBaUJzQixNQUFNLENBQUNDLElBQVAsQ0FBWUMsZUFBWixLQUFnQyxJQUFyRCxFQUEyRDtBQUN6RDtBQUNBLGdCQUFNRixNQUFOO0FBQ0QsU0FIRCxNQUdPO0FBQ0wsZ0JBQUtHLFFBQUwsQ0FBYztBQUFBLG1CQUFPO0FBQUVDLGNBQUFBLFdBQVcsRUFBRSxJQUFmO0FBQXFCQyxjQUFBQSxTQUFTLEVBQUU7QUFBaEMsYUFBUDtBQUFBLFdBQWQ7O0FBQ0EsZ0JBQUtDLE9BQUwsQ0FBYU4sTUFBYjs7QUFFQVAsVUFBQUEsT0FBTyxDQUFDYyxJQUFSO0FBQ0FiLFVBQUFBLHNCQUFzQixDQUFDWCxnQkFBZ0IsR0FBR0MsT0FBcEIsQ0FBdEI7QUFDQSxpQkFBT3dCLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQlQsTUFBaEIsQ0FBUDtBQUNEO0FBQ0YsT0FkSSxXQWVFLGlCQUE4RDtBQUFBLFlBQTNEVSxhQUEyRCxTQUEzREEsYUFBMkQ7QUFBQSxZQUE1Q3hCLE9BQTRDLFNBQTVDQSxPQUE0QztBQUFBLFlBQW5DRyxLQUFtQyxTQUFuQ0EsS0FBbUM7QUFBQSxZQUE1QnNCLFlBQTRCLFNBQTVCQSxZQUE0QjtBQUFBLFlBQVhDLElBQVc7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBakIsUUFBQUEsb0JBQW9CLENBQUNaLGdCQUFnQixHQUFHTSxLQUFwQixDQUFwQjs7QUFFQSxjQUFLYyxRQUFMLENBQWM7QUFBQSxpQkFBTztBQUNuQlUsWUFBQUEsVUFBVSxFQUFFLEtBRE87QUFFbkJULFlBQUFBLFdBQVcsRUFBRSxjQUZNO0FBR25CQyxZQUFBQSxTQUFTLEVBQUU7QUFIUSxXQUFQO0FBQUEsU0FBZDtBQUtELE9BN0JJLENBQVA7QUE4QkQsS0FsRWtCO0FBQUEsZ0dBb0VULFVBQUFkLEtBQUssRUFBSTtBQUFBLFVBRVBXLGVBRk8sR0FHYlgsS0FIYSxDQUVmVSxJQUZlLENBRVBDLGVBRk87QUFBQSxVQUtUWSxPQUxTLEdBS0csTUFBS3ZCLEtBTFIsQ0FLVHVCLE9BTFM7QUFPakJBLE1BQUFBLE9BQU8sQ0FBQ1osZUFBRCxDQUFQO0FBRUFhLE1BQUFBLFlBQVksQ0FBQ0MsT0FBYixDQUFxQixNQUFyQixFQUE2QkMsSUFBSSxDQUFDQyxTQUFMLG9DQUFvQmhCLGVBQXBCLEVBQTdCO0FBQ0QsS0E5RWtCO0FBR2pCLFVBQUtpQixLQUFMLEdBQWEsTUFBS0MsWUFBbEI7QUFFQSxVQUFLQyxNQUFMLEdBQWMsTUFBS0EsTUFBTCxDQUFZQyxJQUFaLGdEQUFkO0FBTGlCO0FBTWxCOzs7OzZCQU1RQyxLLEVBQU87QUFBQTs7QUFDZCxhQUFPLGtDQUFjQSxLQUFkLEVBQ0p4QixJQURJLENBQ0MsVUFBQXlCLFFBQVEsRUFBSTtBQUNoQixZQUFJQSxRQUFRLENBQUNDLE1BQVQsSUFBbUIsR0FBbkIsSUFBMEIsQ0FBQ0MsUUFBUSxDQUFDQyxNQUF4QyxFQUFnRDtBQUM5QyxnQkFBTUgsUUFBTjtBQUNELFNBRkQsTUFFTztBQUNMLGlCQUFPLE1BQUksQ0FBQ0ksT0FBTCxDQUFhTCxLQUFLLENBQUNNLEtBQW5CLENBQVA7QUFDRDtBQUNGLE9BUEksV0FRRSxVQUFBeEMsS0FBSyxFQUFJO0FBQUEsWUFDTm9DLE1BRE0sR0FDS3BDLEtBREwsQ0FDTm9DLE1BRE07O0FBRWQsUUFBQSxNQUFJLENBQUN0QixRQUFMLENBQWM7QUFBQSxpQkFBTztBQUFFVSxZQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQlIsWUFBQUEsU0FBUyxFQUFFLEtBQWhDO0FBQXVDRCxZQUFBQSxXQUFXLEVBQUU7QUFBcEQsV0FBUDtBQUFBLFNBQWQ7O0FBQ0EsMENBQWlCZixLQUFqQjs7QUFFQSxZQUFJb0MsTUFBTSxLQUFLLEdBQVgsSUFBa0JBLE1BQU0sS0FBSyxHQUFqQyxFQUFzQztBQUNwQyxnQkFBTSxJQUFJSywwQkFBSixDQUFvQjtBQUFFQyxZQUFBQSxNQUFNLEVBQUU7QUFBVixXQUFwQixDQUFOO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsZ0JBQU0sSUFBSUQsMEJBQUosQ0FBb0I7QUFBRUMsWUFBQUEsTUFBTSxFQUFFO0FBQVYsV0FBcEIsQ0FBTjtBQUNEO0FBQ0YsT0FsQkksQ0FBUDtBQW1CRDs7OzJCQWdETVIsSyxFQUFPO0FBQUE7O0FBQ1osVUFBTXRCLElBQUksR0FBRztBQUFFSCxRQUFBQSxTQUFTLEVBQUVrQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCVixLQUFsQjtBQUFiLE9BQWI7QUFDQTVDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEdBQVosRUFBaUIyQyxLQUFqQjtBQUVBLFdBQUtwQixRQUFMLENBQWMsaUJBQStCO0FBQUEsWUFBNUJVLFVBQTRCLFNBQTVCQSxVQUE0QjtBQUFBLFlBQWhCUixTQUFnQixTQUFoQkEsU0FBZ0I7QUFDM0MsZUFBTztBQUFFUSxVQUFBQSxVQUFVLEVBQUUsQ0FBQ0EsVUFBZjtBQUEyQlIsVUFBQUEsU0FBUyxFQUFFLENBQUNBO0FBQXZDLFNBQVA7QUFDRCxPQUZEO0FBSUEsYUFBTyxLQUFLZCxLQUFMLENBQVcsZ0JBQVgsRUFBNkJVLElBQTdCLEVBQ0pGLElBREksQ0FDQyxVQUFBeUIsUUFBUSxFQUFJO0FBQ2hCLFlBQUlBLFFBQVEsQ0FBQzlDLE1BQWIsRUFBcUI7QUFDbkIsZ0JBQU04QyxRQUFOO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsVUFBQSxNQUFJLENBQUNVLFFBQUwsQ0FBYztBQUNaTCxZQUFBQSxLQUFLLEVBQUVOLEtBQUssQ0FBQ2hELEtBREQ7QUFFWjRELFlBQUFBLEdBQUcsRUFBRVosS0FBSyxDQUFDL0M7QUFGQyxXQUFkOztBQUlBLGlCQUFPZ0MsT0FBTyxDQUFDQyxPQUFSLENBQWdCZSxRQUFoQixDQUFQO0FBQ0Q7QUFDRixPQVhJLFdBWUUsVUFBQW5DLEtBQUssRUFBSTtBQUNkVixRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVMsS0FBWjs7QUFDQSxRQUFBLE1BQUksQ0FBQ0UsS0FBTCxDQUFXSSxvQkFBWCxDQUFnQ1osZ0JBQWdCLEdBQUdNLEtBQW5EOztBQUNBLFFBQUEsTUFBSSxDQUFDYyxRQUFMLENBQWM7QUFBQSxpQkFBTztBQUNuQlUsWUFBQUEsVUFBVSxFQUFFLEtBRE87QUFFbkJULFlBQUFBLFdBQVcsRUFBRSxpQ0FGTTtBQUduQkMsWUFBQUEsU0FBUyxFQUFFO0FBSFEsV0FBUDtBQUFBLFNBQWQ7QUFLRCxPQXBCSSxDQUFQO0FBcUJEOzs7NkJBRVE7QUFBQSx5QkFDNEMsS0FBS2QsS0FEakQ7QUFBQSxVQUNDNkMsWUFERCxnQkFDQ0EsWUFERDtBQUFBLFVBQ2VDLFFBRGYsZ0JBQ2VBLFFBRGY7QUFBQSxVQUN5QkMsT0FEekIsZ0JBQ3lCQSxPQUR6QjtBQUFBLFVBQ2tDakQsS0FEbEMsZ0JBQ2tDQSxLQURsQztBQUFBLHdCQUV3QyxLQUFLOEIsS0FGN0M7QUFBQSxVQUVDZCxTQUZELGVBRUNBLFNBRkQ7QUFBQSxVQUVZRCxXQUZaLGVBRVlBLFdBRlo7QUFBQSxVQUV5QlMsVUFGekIsZUFFeUJBLFVBRnpCO0FBR1BsQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXlELFFBQVosRUFBc0J4QixVQUF0QixFQUFrQ3lCLE9BQWxDO0FBRUEsYUFDRSxnQ0FBQyxlQUFEO0FBQU0sUUFBQSxRQUFRLEVBQUVGLFlBQVksQ0FBQyxLQUFLZixNQUFOO0FBQTVCLFNBQ0UsZ0NBQUMsb0JBQUQsT0FERixFQUdFLGdDQUFDLGVBQUQ7QUFBSyxRQUFBLEVBQUUsRUFBRTtBQUFULFNBQ0UsZ0NBQUMsNENBQUQsUUFDRSxnQ0FBQyxnQkFBRDtBQUNFLFFBQUEsSUFBSSxFQUFFLE9BRFI7QUFFRSxRQUFBLFNBQVMsRUFBRWtCLGdDQUZiO0FBR0UsUUFBQSxXQUFXLEVBQUUsT0FIZjtBQUlFLFFBQUEsSUFBSSxFQUFDLE1BSlA7QUFLRSxRQUFBLElBQUksRUFBRTtBQUxSLFFBREYsQ0FERixFQVdFLGdDQUFDLGdCQUFEO0FBQ0UsUUFBQSxJQUFJLEVBQUUsVUFEUjtBQUVFLFFBQUEsV0FBVyxFQUFFLFFBRmY7QUFHRSxRQUFBLE9BQU8sRUFBRSxXQUhYO0FBSUUsUUFBQSxTQUFTLEVBQUVDO0FBSmIsUUFYRixFQWtCRSxnQ0FBQywwQ0FBRCxRQUNFLGdDQUFDLGdCQUFEO0FBQ0UsUUFBQSxJQUFJLEVBQUUsVUFEUjtBQUVFLFFBQUEsV0FBVyxFQUFFLG1CQUZmO0FBR0UsUUFBQSxPQUFPLEVBQUUsV0FIWDtBQUlFLFFBQUEsU0FBUyxFQUFFQTtBQUpiLFFBREYsQ0FsQkYsQ0FIRixFQThCRSxnQ0FBQyw0QkFBRDtBQUNFLFFBQUEsUUFBUSxFQUFFSCxRQUFRLElBQUl4QixVQUFaLElBQTBCeUIsT0FEdEM7QUFFRSxRQUFBLEVBQUUsRUFBRSxDQUZOO0FBR0UsUUFBQSxTQUFTLEVBQUVqQyxTQUhiO0FBSUUsUUFBQSxLQUFLLEVBQUVoQixLQUFLLElBQUllO0FBSmxCLFNBS0UsZ0NBQUMsdUJBQUQ7QUFBYSxRQUFBLFFBQVEsRUFBRWYsS0FBdkI7QUFBOEIsUUFBQSxPQUFPLEVBQUVBO0FBQXZDLDBDQUxGLENBOUJGLENBREY7QUEwQ0Q7Ozt3QkF0SmtCO0FBQ2pCLGFBQU87QUFBRXdCLFFBQUFBLFVBQVUsRUFBRSxLQUFkO0FBQXFCVCxRQUFBQSxXQUFXLEVBQUUsSUFBbEM7QUFBd0NDLFFBQUFBLFNBQVMsRUFBRTtBQUFuRCxPQUFQO0FBQ0Q7OztFQWZtQ29DLGdCOzs7aUNBQXpCbkQsZ0Isa0RBRU5vRCw0QjtBQW9LUCwyQkFBQXBELGdCQUFnQixHQUFHLGdDQUFXQSxnQkFBWCxDQUFuQjtBQUNBLDJCQUFBQSxnQkFBZ0IsR0FBRyw2QkFBV0EsZ0JBQVgsQ0FBbkI7QUFFQSwyQkFBQUEsZ0JBQWdCLEdBQUcsMEJBQVFxRCxnQ0FBUixFQUE4QjtBQUMvQ0MsRUFBQUEsSUFBSSxFQUFFO0FBRHlDLENBQTlCLEVBRWhCdEQsZ0JBRmdCLENBQW5CO0FBSUEsMkJBQUFBLGdCQUFnQixHQUFHLHlCQUNqQixVQUFBNkIsS0FBSztBQUFBLFNBQUs7QUFDUjBCLElBQUFBLE1BQU0sRUFBRSw4QkFBYyxrQkFBZCxFQUFrQzFCLEtBQWxDO0FBREEsR0FBTDtBQUFBLENBRFksRUFJakIsVUFBQTJCLFFBQVE7QUFBQSxTQUFLO0FBQ1hoQyxJQUFBQSxPQUFPLEVBQUUsaUJBQUFpQyxJQUFJO0FBQUEsYUFBSUQsUUFBUSxDQUFDO0FBQUVFLFFBQUFBLElBQUksRUFBRUMscUJBQVI7QUFBa0JGLFFBQUFBLElBQUksRUFBRUE7QUFBeEIsT0FBRCxDQUFaO0FBQUEsS0FERjtBQUVYckQsSUFBQUEsc0JBQXNCLEVBQUUsZ0NBQUFSLE9BQU87QUFBQSxhQUFJNEQsUUFBUSxDQUFDLDJDQUFRNUQsT0FBUixDQUFELENBQVo7QUFBQSxLQUZwQjtBQUdYUyxJQUFBQSxvQkFBb0IsRUFBRSw4QkFBQVQsT0FBTztBQUFBLGFBQUk0RCxRQUFRLENBQUMseUNBQU01RCxPQUFOLENBQUQsQ0FBWjtBQUFBO0FBSGxCLEdBQUw7QUFBQSxDQUpTLEVBU2pCSSxnQkFUaUIsQ0FBbkI7QUFXQSwyQkFBQUEsZ0JBQWdCLEdBQUcsMEJBQVU7QUFDM0I0RCxFQUFBQSxJQUFJLEVBQUUsa0JBRHFCO0FBRTNCNUUsRUFBQUEsUUFBUSxFQUFSQTtBQUYyQixDQUFWLEVBR2hCZ0IsZ0JBSGdCLENBQW5CO2VBS2VBLGdCLEVBRWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnO1xyXG5pbXBvcnQgeyB3aXRoUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XHJcbmltcG9ydCB7IGdyYXBocWwsIHdpdGhBcG9sbG8gfSBmcm9tICdyZWFjdC1hcG9sbG8nO1xyXG5pbXBvcnQgeyBzdWNjZXNzLCBlcnJvciB9IGZyb20gJ3JlYWN0LW5vdGlmaWNhdGlvbi1zeXN0ZW0tcmVkdXgnO1xyXG5pbXBvcnQgeyBGaWVsZCwgcmVkdXhGb3JtLCBTdWJtaXNzaW9uRXJyb3IsIEZvcm0sIGdldEZvcm1WYWx1ZXMgfSBmcm9tICdyZWR1eC1mb3JtJztcclxuaW1wb3J0IHsgY2FwdHVyZUV4Y2VwdGlvbiB9IGZyb20gJy4uLy4uLy4uLy4uL2hvY3Mvd2l0aFNlbnRyeS93aXRoU2VudHJ5JztcclxuXHJcbi8qKiBWaWV3ICovXHJcbmltcG9ydCBCb3ggZnJvbSAnQGxpYi91aS9Cb3gvQm94JztcclxuaW1wb3J0IFRvb2x0aXBCYXNlIGZyb20gJ0BsaWIvdWkvVG9vbHRpcEJhc2UvVG9vbHRpcEJhc2UnO1xyXG5pbXBvcnQgRm9ybUJ1dHRvblN1Ym1pdCBmcm9tICdAbGliL3VpL0Zvcm1CdXR0b25TdWJtaXQvRm9ybUJ1dHRvblN1Ym1pdCc7XHJcbmltcG9ydCBUZXh0RmllbGRXaXRoVG9vbHRpcCBmcm9tICdAbGliL3VpL1RleHRGaWVsZFdpdGhUb29sdGlwL1RleHRGaWVsZFdpdGhUb29sdGlwJztcclxuaW1wb3J0IHsgVGV4dEZpZWxkTGFzdFdyYXBwZXIgfSBmcm9tICdAbGliL3VpL1RleHRGaWVsZExhc3RXcmFwcGVyL1RleHRGaWVsZExhc3RXcmFwcGVyJztcclxuaW1wb3J0IHsgVGV4dEZpZWxkRmlyc3RXcmFwcGVyIH0gZnJvbSAnQGxpYi91aS9UZXh0RmllbGRGaXJzdFdyYXBwZXIvVGV4dEZpZWxkRmlyc3RXcmFwcGVyJztcclxuXHJcbi8qKiBDb21wb25lbnRzICovXHJcbmltcG9ydCBGb3JtTG9nbyBmcm9tICcuLi9Gb3JtTG9nby9Gb3JtTG9nbyc7XHJcbmltcG9ydCBGaWVsZElucHV0UGFzc3dvcmQgZnJvbSAnLi4vRmllbGRJbnB1dFBhc3N3b3JkL0ZpZWxkSW5wdXRQYXNzd29yZCc7XHJcbmltcG9ydCB7IEZldGNoVXNlckF1dGggfSBmcm9tICcuLi9GZXRjaFVzZXJBdXRoL0ZldGNoVXNlckF1dGgnO1xyXG5cclxuLyoqIFByb3BUeXBlcyAqL1xyXG5pbXBvcnQgeyBmb3JtUHJvcFR5cGVzIH0gZnJvbSAnLi4vLi4vLi4vLi4vcHJvcFR5cGVzL0Zvcm1zL0Zvcm1Qcm9wVHlwZXMnO1xyXG5cclxuLyoqIEdyYXBoUUwgc2NoZW1hICovXHJcbmltcG9ydCBBY3RpdmF0ZVVzZXJNdXRhdGlvbiBmcm9tICcuL0FjdGl2YXRlVXNlck11dGF0aW9uLmdyYXBocWwnO1xyXG5pbXBvcnQgQ3VycmVudFVzZXJJdGVtUXVlcnkgZnJvbSAnLi9DdXJyZW50VXNlckl0ZW1RdWVyeS5ncmFwaHFsJztcclxuXHJcbi8qKiBWYWxpZGF0aW9uICovXHJcbmltcG9ydCBpc0VtYWlsIGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3ZhbGlkYXRpb24vaXNFbWFpbCc7XHJcbmltcG9ydCByZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi91dGlscy92YWxpZGF0aW9uL3JlcXVpcmVkJztcclxuXHJcbi8qKiBDb25zdGF0bnRzICovXHJcbmltcG9ydCB7IFVTRVJfQUREIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3RvcmUvcmVkdWNlcnMvdXNlci9hY3Rpb25UeXBlcyc7XHJcblxyXG5jb25zdCB2YWxpZGF0ZSA9ICh7IGVtYWlsLCBwYXNzd29yZCwgcmV0cnlQYXMgfSkgPT4ge1xyXG4gIGNvbnN0IGVycm9ycyA9IHt9O1xyXG4gIGNvbnNvbGUubG9nKCd2YWxpZGF0ZTogJyxlbWFpbCwgcGFzc3dvcmQsIHJldHJ5UGFzKTtcclxuICBpZiAoIWVtYWlsKSB7XHJcbiAgICBlcnJvcnMuZW1haWwgPSAn0J7QsdGP0LfQsNGC0LXQu9GM0L3QviDQtNC70Y8g0LfQsNC/0L7Qu9C90LXQvdC40Y8nO1xyXG4gIH1cclxuICBpZiAoIWlzRW1haWwoZXJyb3JzLmVtYWlsKSkge1xyXG4gICAgZXJyb3JzLmVtYWlsID0gaXNFbWFpbChlcnJvcnMuZW1haWwpO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFwYXNzd29yZCkge1xyXG4gICAgZXJyb3JzLnBhc3N3b3JkID0gJ9Ce0LHRj9C30LDRgtC10LvRjNC90L4g0LTQu9GPINC30LDQv9C+0LvQvdC10L3QuNGPJztcclxuICB9XHJcblxyXG4gIGlmICghcmV0cnlQYXMpIHtcclxuICAgIGVycm9ycy5yZXRyeVBhcyA9ICfQntCx0Y/Qt9Cw0YLQtdC70YzQvdC+INC00LvRjyDQt9Cw0L/QvtC70L3QtdC90LjRjyc7XHJcbiAgfVxyXG5cclxuICBpZiAocGFzc3dvcmQgIT09IHVuZGVmaW5lZCAmJiBwYXNzd29yZC5sZW5ndGggPD0gNykge1xyXG4gICAgZXJyb3JzLnBhc3N3b3JkID0gJ9Cf0LDRgNC+0LvRjCDQtNC+0LvQttC10L0g0YHQvtGB0YLQvtGP0YLRjCDQvNC40L3QuNC80YPQvCDQuNC3IDgg0YHQuNC80LLQvtC70L7Qsic7XHJcbiAgfVxyXG5cclxuICBpZiAocGFzc3dvcmQgIT09IHVuZGVmaW5lZCAmJiBwYXNzd29yZC5sZW5ndGggPj0gMzApIHtcclxuICAgIGVycm9ycy5wYXNzd29yZCA9ICfQn9Cw0YDQvtC70Ywg0LTQvtC70LbQtdC9INGB0L7RgdGC0L7Rj9GC0Ywg0L3QtSDQsdC+0LvRjNGI0LUgMzAg0YHQuNC80LLQvtC70L7Qsic7XHJcbiAgfVxyXG5cclxuICBpZiAocGFzc3dvcmQgIT09IHJldHJ5UGFzKSB7XHJcbiAgICBlcnJvcnMucmV0cnlQYXMgPSAn0J/QsNGA0L7Qu9C4INC90LUg0YHQvtCy0L/QsNC00LDRjtGCJztcclxuICB9XHJcblxyXG4gIHJldHVybiBlcnJvcnM7XHJcbn07XHJcblxyXG5jb25zdCBub3RpZmljYXRpb25PcHRzID0gKCkgPT4gKHtcclxuICBzdWNjZXNzOiB7XHJcbiAgICB0aXRsZTogJ9Cf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDRg9GB0L/QtdGI0L3QviDQt9Cw0YDQtdCz0LjRgdGC0YDQuNGA0L7QstCw0L0nLFxyXG4gICAgbWVzc2FnZTogJ9Cf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDRg9GB0L/QtdGI0L3QviDQt9Cw0YDQtdCz0LjRgdGC0YDQuNGA0L7QstCw0L0nLFxyXG4gICAgcG9zaXRpb246ICd0cicsXHJcbiAgICBhdXRvRGlzbWlzczogMixcclxuICB9LFxyXG4gIGVycm9yOiB7XHJcbiAgICB0aXRsZTogJ9Cf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvdC1INCx0YvQuyDQt9Cw0YDQtdCz0LjRgdGC0YDQuNGA0L7QstCw0L0nLFxyXG4gICAgbWVzc2FnZTogJ9Cf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvdC1INCx0YvQuyDQt9Cw0YDQtdCz0LjRgdGC0YDQuNGA0L7QstCw0L0nLFxyXG4gICAgcG9zaXRpb246ICd0cicsXHJcbiAgICBhdXRvRGlzbWlzczogMixcclxuICB9LFxyXG59KTtcclxuXHJcbmV4cG9ydCBjbGFzcyBGb3JtUmVnaXN0cmF0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcclxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xyXG4gICAgLi4uZm9ybVByb3BUeXBlcyxcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG5cclxuICAgIHRoaXMuc3RhdGUgPSB0aGlzLmluaXRpYWxTdGF0ZTtcclxuXHJcbiAgICB0aGlzLnN1Ym1pdCA9IHRoaXMuc3VibWl0LmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBnZXQgaW5pdGlhbFN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHsgc3VibWl0dGluZzogZmFsc2UsIGFwb2xsb0Vycm9yOiBudWxsLCBpc0xvYWRpbmc6IGZhbHNlIH07XHJcbiAgfVxyXG5cclxuICB1c2VyQXV0aCh2YWx1ZSkge1xyXG4gICAgcmV0dXJuIEZldGNoVXNlckF1dGgodmFsdWUpXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCB8fCAhZG9jdW1lbnQuY29va2llKSB7XHJcbiAgICAgICAgICB0aHJvdyByZXNwb25zZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXNlcih2YWx1ZS51bmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGNvbnN0IHsgc3RhdHVzIH0gPSBlcnJvcjtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7IHN1Ym1pdHRpbmc6IGZhbHNlLCBpc0xvYWRpbmc6IGZhbHNlLCBhcG9sbG9FcnJvcjogbnVsbCB9KSk7XHJcbiAgICAgICAgY2FwdHVyZUV4Y2VwdGlvbihlcnJvcik7XHJcblxyXG4gICAgICAgIGlmIChzdGF0dXMgPT09IDQwMSB8fCBzdGF0dXMgPT09IDQwMykge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IFN1Ym1pc3Npb25FcnJvcih7IF9lcnJvcjogJ9Cd0LUg0LLQtdGA0L3QviDQstCy0LXQtNC10L0g0LvQvtCz0LjQvSDQuNC70Lgg0L/QsNGA0L7Qu9GMJyB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IFN1Ym1pc3Npb25FcnJvcih7IF9lcnJvcjogJ9Cf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvdC1INC90LDQudC00LXQvScgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFVzZXIgPSBlbWFpbCA9PiB7XHJcbiAgICBjb25zdCB7IGNsaWVudCwgaGlzdG9yeSwgc2V0Tm90aWZpY2F0aW9uU3VjY2Vzcywgc2V0Tm90aWZpY2F0aW9uRXJyb3IgfSA9IHRoaXMucHJvcHM7XHJcbiAgICByZXR1cm4gY2xpZW50XHJcbiAgICAgIC5xdWVyeSh7IHF1ZXJ5OiBDdXJyZW50VXNlckl0ZW1RdWVyeSwgdmFyaWFibGVzOiB7IGVtYWlsOiBlbWFpbCB9IH0pXHJcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5lcnJvcnMgfHwgcmVzdWx0LmRhdGEuY3VycmVudHVzZXJpdGVtID09PSBudWxsKSB7XHJcbiAgICAgICAgICAvLyBUTyBETyBjaGFuZ2UgdGhpc1xyXG4gICAgICAgICAgdGhyb3cgcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7IGFwb2xsb0Vycm9yOiBudWxsLCBpc0xvYWRpbmc6IGZhbHNlIH0pKTtcclxuICAgICAgICAgIHRoaXMuc2V0VXNlcihyZXN1bHQpO1xyXG5cclxuICAgICAgICAgIGhpc3RvcnkucHVzaChgL2FwcC9wcm9qZWN0LWxpc3RgKTtcclxuICAgICAgICAgIHNldE5vdGlmaWNhdGlvblN1Y2Nlc3Mobm90aWZpY2F0aW9uT3B0cygpLnN1Y2Nlc3MpO1xyXG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKCh7IGdyYXBoUUxFcnJvcnMsIG1lc3NhZ2UsIGVycm9yLCBuZXR3b3JrRXJyb3IsIC4uLnJlc3QgfSkgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdncmFwaFFMRXJyb3JzOiAnLCBncmFwaFFMRXJyb3JzKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnbWVzc2FnZTogJywgbWVzc2FnZSk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ25ldHdvcmtFcnJvcjogJywgbmV0d29ya0Vycm9yKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygncmVzdDogJywgcmVzdCk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2Vycm9yOiAnLCBlcnJvcik7XHJcblxyXG4gICAgICAgIHNldE5vdGlmaWNhdGlvbkVycm9yKG5vdGlmaWNhdGlvbk9wdHMoKS5lcnJvcik7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4gKHtcclxuICAgICAgICAgIHN1Ym1pdHRpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgYXBvbGxvRXJyb3I6ICfQntGI0LjQsdC60LAg0LLRhdC+0LTQsCcsXHJcbiAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgc2V0VXNlciA9IHByb3BzID0+IHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgZGF0YTogeyBjdXJyZW50dXNlcml0ZW0gfSxcclxuICAgIH0gPSBwcm9wcztcclxuXHJcbiAgICBjb25zdCB7IGFkZFVzZXIgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgYWRkVXNlcihjdXJyZW50dXNlcml0ZW0pO1xyXG5cclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyJywgSlNPTi5zdHJpbmdpZnkoeyAuLi5jdXJyZW50dXNlcml0ZW0gfSkpO1xyXG4gIH07XHJcblxyXG4gIHN1Ym1pdCh2YWx1ZSkge1xyXG4gICAgY29uc3QgZGF0YSA9IHsgdmFyaWFibGVzOiBPYmplY3QuYXNzaWduKHt9LCB2YWx1ZSkgfTtcclxuICAgIGNvbnNvbGUubG9nKDEyMywgdmFsdWUpO1xyXG5cclxuICAgIHRoaXMuc2V0U3RhdGUoKHsgc3VibWl0dGluZywgaXNMb2FkaW5nIH0pID0+IHtcclxuICAgICAgcmV0dXJuIHsgc3VibWl0dGluZzogIXN1Ym1pdHRpbmcsIGlzTG9hZGluZzogIWlzTG9hZGluZyB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucHJvcHNbJ0BhcG9sbG8vY3JlYXRlJ10oZGF0YSlcclxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcnMpIHtcclxuICAgICAgICAgIHRocm93IHJlc3BvbnNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnVzZXJBdXRoKHtcclxuICAgICAgICAgICAgdW5hbWU6IHZhbHVlLmVtYWlsLFxyXG4gICAgICAgICAgICB1cHM6IHZhbHVlLnBhc3N3b3JkLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgIHRoaXMucHJvcHMuc2V0Tm90aWZpY2F0aW9uRXJyb3Iobm90aWZpY2F0aW9uT3B0cygpLmVycm9yKTtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XHJcbiAgICAgICAgICBzdWJtaXR0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGFwb2xsb0Vycm9yOiAn0J7RiNC40LHQutCwINCw0LLRgtC+0YDQuNC30LDRhtC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPJyxcclxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHsgaGFuZGxlU3VibWl0LCBwcmlzdGluZSwgaW52YWxpZCwgZXJyb3IgfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCB7IGlzTG9hZGluZywgYXBvbGxvRXJyb3IsIHN1Ym1pdHRpbmcgfSA9IHRoaXMuc3RhdGU7XHJcbiAgICBjb25zb2xlLmxvZyhwcmlzdGluZSwgc3VibWl0dGluZywgaW52YWxpZCk7XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPEZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdCh0aGlzLnN1Ym1pdCl9PlxyXG4gICAgICAgIDxGb3JtTG9nbyAvPlxyXG5cclxuICAgICAgICA8Qm94IG1iPXsnMTAwcHgnfT5cclxuICAgICAgICAgIDxUZXh0RmllbGRGaXJzdFdyYXBwZXI+XHJcbiAgICAgICAgICAgIDxGaWVsZFxyXG4gICAgICAgICAgICAgIG5hbWU9eydlbWFpbCd9XHJcbiAgICAgICAgICAgICAgY29tcG9uZW50PXtUZXh0RmllbGRXaXRoVG9vbHRpcH1cclxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17J9Cb0L7Qs9C40L0nfVxyXG4gICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcclxuICAgICAgICAgICAgICBsZWZ0PXsnNDAlJ31cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgIDwvVGV4dEZpZWxkRmlyc3RXcmFwcGVyPlxyXG5cclxuICAgICAgICAgIDxGaWVsZFxyXG4gICAgICAgICAgICBuYW1lPXsncGFzc3dvcmQnfVxyXG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17J9Cf0LDRgNC+0LvRjCd9XHJcbiAgICAgICAgICAgIHZhcmlhbnQ9eydzZWNvbmRhcnknfVxyXG4gICAgICAgICAgICBjb21wb25lbnQ9e0ZpZWxkSW5wdXRQYXNzd29yZH1cclxuICAgICAgICAgIC8+XHJcblxyXG4gICAgICAgICAgPFRleHRGaWVsZExhc3RXcmFwcGVyPlxyXG4gICAgICAgICAgICA8RmllbGRcclxuICAgICAgICAgICAgICBuYW1lPXsncmV0cnlQYXMnfVxyXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXsn0J/QvtGC0LLQtdGA0LTQuNGC0LUg0L/QsNGA0L7Qu9GMJ31cclxuICAgICAgICAgICAgICB2YXJpYW50PXsnc2Vjb25kYXJ5J31cclxuICAgICAgICAgICAgICBjb21wb25lbnQ9e0ZpZWxkSW5wdXRQYXNzd29yZH1cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgIDwvVGV4dEZpZWxkTGFzdFdyYXBwZXI+XHJcbiAgICAgICAgPC9Cb3g+XHJcbiAgICAgICAgPEZvcm1CdXR0b25TdWJtaXRcclxuICAgICAgICAgIGRpc2FibGVkPXtwcmlzdGluZSB8fCBzdWJtaXR0aW5nIHx8IGludmFsaWR9XHJcbiAgICAgICAgICBtbD17OX1cclxuICAgICAgICAgIGlzTG9hZGluZz17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgZXJyb3I9e2Vycm9yIHx8IGFwb2xsb0Vycm9yfT5cclxuICAgICAgICAgIDxUb29sdGlwQmFzZSBpc0FjdGl2ZT17ZXJyb3J9IHdhcm5pbmc9e2Vycm9yfT5cclxuICAgICAgICAgICAg0JLQvtC50YLQuFxyXG4gICAgICAgICAgPC9Ub29sdGlwQmFzZT5cclxuICAgICAgICA8L0Zvcm1CdXR0b25TdWJtaXQ+XHJcbiAgICAgIDwvRm9ybT5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5Gb3JtUmVnaXN0cmF0aW9uID0gd2l0aFJvdXRlcihGb3JtUmVnaXN0cmF0aW9uKTtcclxuRm9ybVJlZ2lzdHJhdGlvbiA9IHdpdGhBcG9sbG8oRm9ybVJlZ2lzdHJhdGlvbik7XHJcblxyXG5Gb3JtUmVnaXN0cmF0aW9uID0gZ3JhcGhxbChBY3RpdmF0ZVVzZXJNdXRhdGlvbiwge1xyXG4gIG5hbWU6ICdAYXBvbGxvL2NyZWF0ZScsXHJcbn0pKEZvcm1SZWdpc3RyYXRpb24pO1xyXG5cclxuRm9ybVJlZ2lzdHJhdGlvbiA9IGNvbm5lY3QoXHJcbiAgc3RhdGUgPT4gKHtcclxuICAgIHZhbHVlczogZ2V0Rm9ybVZhbHVlcygnRm9ybVJlZ2lzdHJhdGlvbicpKHN0YXRlKSxcclxuICB9KSxcclxuICBkaXNwYXRjaCA9PiAoe1xyXG4gICAgYWRkVXNlcjogdXNlciA9PiBkaXNwYXRjaCh7IHR5cGU6IFVTRVJfQURELCB1c2VyOiB1c2VyIH0pLFxyXG4gICAgc2V0Tm90aWZpY2F0aW9uU3VjY2VzczogbWVzc2FnZSA9PiBkaXNwYXRjaChzdWNjZXNzKG1lc3NhZ2UpKSxcclxuICAgIHNldE5vdGlmaWNhdGlvbkVycm9yOiBtZXNzYWdlID0+IGRpc3BhdGNoKGVycm9yKG1lc3NhZ2UpKSxcclxuICB9KSxcclxuKShGb3JtUmVnaXN0cmF0aW9uKTtcclxuXHJcbkZvcm1SZWdpc3RyYXRpb24gPSByZWR1eEZvcm0oe1xyXG4gIGZvcm06ICdGb3JtUmVnaXN0cmF0aW9uJyxcclxuICB2YWxpZGF0ZSxcclxufSkoRm9ybVJlZ2lzdHJhdGlvbik7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtUmVnaXN0cmF0aW9uO1xyXG5cclxuLy8gdmFsaWRhdGU9e1tyZXF1aXJlZCwgaXNFbWFpbF19XHJcbiJdfQ==