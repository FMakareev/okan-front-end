b9baf58383776fbe763e695dcd93aea5
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.TextFieldArray = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _gridStyled = require("grid-styled");

var _reactSelect = require("react-select");

var _SvgAdd = require("../Icons/SvgAdd");

var _SvgDelete = require("../Icons/SvgDelete");

var _ButtonBase = _interopRequireDefault(require("../ButtonBase/ButtonBase"));

var _Text = _interopRequireDefault(require("../Text/Text"));

var _Flex = _interopRequireDefault(require("../Flex/Flex"));

var _SelectBase = require("@lib/ui/SelectBase/SelectBase");

var _fastDeepEqual = _interopRequireDefault(require("fast-deep-equal"));

/** Image */

/** view */
var FlexStyled =
/*#__PURE__*/
(0, _styledComponents["default"])(_Flex["default"]).withConfig({
  componentId: "sc-19425i0-0"
})(["border-top:1px solid #00649c;border-radius:0px;"]);
var NewSelectStyles = (0, _objectSpread2["default"])({}, _SelectBase.SelectStyles, {
  control: function control(style, props) {
    return (0, _objectSpread2["default"])({}, style, {
      width: '100%',
      padding: '0 0 0 10px',
      border: 'none',
      borderRadius: 0,
      cursor: 'pointer',
      ':hover': {
        border: 'none',
        boxShadow: 'none'
      }
    }, props.isFocused ? {
      border: 'none',
      boxShadow: 'none'
    } : {}, props.menuIsOpen ? {
      borderRadius: '0',
      border: 'none'
    } : {});
  },
  menu: function menu(style) {
    return (0, _objectSpread2["default"])({}, style, {
      margin: 0,
      borderRadius: '5px'
    });
  }
});

var ControlComponent = function ControlComponent(props) {
  return _react["default"].createElement(FlexStyled, {
    py: 2,
    alignItems: 'center',
    justifyContent: 'space-between',
    width: '100%'
  }, _react["default"].createElement(_SvgAdd.SvgAdd, null), _react["default"].createElement(_reactSelect.components.Control, props));
};
/**
 * Компонент инпута c доабвлением еще инпутов (Text Field Array)
 * @example ./TextFieldArray.example.md
 */


var TextFieldArray =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(TextFieldArray, _Component);

  function TextFieldArray(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, TextFieldArray);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(TextFieldArray).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onDelete", function (value) {
      try {
        var input = _this.props.input;
        input.onChange(_this.compareOptions(input.value, [value]));
      } catch (error) {
        console.error('Error onDelete: ', error);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onChange", function (value) {
      var _this$props = _this.props,
          input = _this$props.input,
          valueKey = _this$props.valueKey;
      input.onChange([].concat((0, _toConsumableArray2["default"])(input.value), [value[valueKey]]));
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "compareOptions", function () {
      var options1 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var options2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      var valueKey = arguments.length > 2 ? arguments[2] : undefined;

      try {
        if (Array.isArray(options1) && Array.isArray(options2)) {
          return options1.filter(function (item) {
            var result = options2.find(function (child) {
              if (valueKey && typeof valueKey === 'string') {
                return item[valueKey] === child;
              } else {
                return item === child;
              }
            });

            if (result) {
              return false;
            } else {
              return true;
            }
          });
        }

        return [];
      } catch (error) {
        console.error(error);
        return [];
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getOptionName", function (options, id) {
      try {
        var result = options && Array.isArray(options) && options.find(function (item) {
          return item.id === id;
        });

        if (result) {
          return result.name;
        } else {
          return id;
        }
      } catch (error) {
        console.log(error);
        return id;
      }
    });
    _this.state = _this.initialState;
    return _this;
  }

  (0, _createClass2["default"])(TextFieldArray, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (!(0, _fastDeepEqual["default"])(nextProps.options, this.props.options) || !(0, _fastDeepEqual["default"])(nextProps.input.value, this.props.input.value)) {
        var options = nextProps.options,
            valueKey = nextProps.valueKey,
            input = nextProps.input;

        if (input.value && options) {
          this.setState(function () {
            return {
              selectedOption: options && options.filter(function (optionItem) {
                return input.value.find(function (valueItem) {
                  return valueItem === optionItem[valueKey];
                });
              })
            };
          });
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props2 = this.props,
          options = _this$props2.options,
          value = _this$props2.input.value,
          valueKey = _this$props2.valueKey;
      return _react["default"].createElement(_gridStyled.Box, {
        width: '100%'
      }, value && Array.isArray(value) && value.map(function (item, index) {
        return _react["default"].createElement(FlexStyled, {
          py: 3,
          key: "FlexStyled-".concat(index),
          width: '100%',
          alignItems: 'center'
        }, _react["default"].createElement(_ButtonBase["default"], {
          onClick: function onClick() {
            return _this2.onDelete(item);
          },
          type: 'button',
          variant: 'empty'
        }, _react["default"].createElement(_SvgDelete.SvgDelete, null)), _react["default"].createElement(_Text["default"], {
          textAlign: 'center',
          width: '100%',
          fontSize: 6,
          lineHeight: 8,
          fontFamily: 'primary300',
          color: 'color3'
        }, _this2.getOptionName(options, item)));
      }), _react["default"].createElement(_SelectBase.SelectBase, (0, _extends2["default"])({
        placeholder: 'Добавить нового согласующего'
      }, this.props, {
        onChange: this.onChange,
        options: this.compareOptions(options, value, valueKey),
        styles: NewSelectStyles,
        components: {
          Control: ControlComponent
        }
      })));
    }
  }, {
    key: "initialState",
    get: function get() {
      if (this.props.input.value.length) {
        var _this$props3 = this.props,
            options = _this$props3.options,
            valueKey = _this$props3.valueKey,
            input = _this$props3.input;
        return {
          selectedOption: options && options.filter(function (optionItem) {
            return input.value.find(function (valueItem) {
              return valueItem === optionItem[valueKey];
            });
          })
        };
      }

      return {
        selectedOption: []
      };
    }
  }]);
  return TextFieldArray;
}(_react.Component);

exports.TextFieldArray = TextFieldArray;
var _default = TextFieldArray;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRleHRGaWVsZEFycmF5LmpzIl0sIm5hbWVzIjpbIkZsZXhTdHlsZWQiLCJGbGV4IiwiTmV3U2VsZWN0U3R5bGVzIiwiU2VsZWN0U3R5bGVzIiwiY29udHJvbCIsInN0eWxlIiwicHJvcHMiLCJ3aWR0aCIsInBhZGRpbmciLCJib3JkZXIiLCJib3JkZXJSYWRpdXMiLCJjdXJzb3IiLCJib3hTaGFkb3ciLCJpc0ZvY3VzZWQiLCJtZW51SXNPcGVuIiwibWVudSIsIm1hcmdpbiIsIkNvbnRyb2xDb21wb25lbnQiLCJUZXh0RmllbGRBcnJheSIsInZhbHVlIiwiaW5wdXQiLCJvbkNoYW5nZSIsImNvbXBhcmVPcHRpb25zIiwiZXJyb3IiLCJjb25zb2xlIiwidmFsdWVLZXkiLCJvcHRpb25zMSIsIm9wdGlvbnMyIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiaXRlbSIsInJlc3VsdCIsImZpbmQiLCJjaGlsZCIsIm9wdGlvbnMiLCJpZCIsIm5hbWUiLCJsb2ciLCJzdGF0ZSIsImluaXRpYWxTdGF0ZSIsIm5leHRQcm9wcyIsInNldFN0YXRlIiwic2VsZWN0ZWRPcHRpb24iLCJvcHRpb25JdGVtIiwidmFsdWVJdGVtIiwibWFwIiwiaW5kZXgiLCJvbkRlbGV0ZSIsImdldE9wdGlvbk5hbWUiLCJDb250cm9sIiwibGVuZ3RoIiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUE7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBVkE7O0FBS0E7QUFPQSxJQUFNQSxVQUFVO0FBQUE7QUFBRyxrQ0FBT0MsZ0JBQVAsQ0FBSDtBQUFBO0FBQUEsdURBQWhCO0FBS0EsSUFBTUMsZUFBZSxzQ0FDaEJDLHdCQURnQjtBQUVuQkMsRUFBQUEsT0FBTyxFQUFFLGlCQUFDQyxLQUFELEVBQVFDLEtBQVIsRUFBa0I7QUFDekIsOENBQ0tELEtBREw7QUFF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QVU7QUFBQSxtQkFDdkJ4QixLQUFLLENBQUNELEtBQU4sQ0FBWWMsSUFBWixDQUFpQixVQUFBWSxTQUFTO0FBQUEscUJBQUlBLFNBQVMsS0FBS0QsVUFBVSxDQUFDbkIsUUFBRCxDQUE1QjtBQUFBLGFBQTFCLENBRHVCO0FBQUEsV0FBekI7QUFIRyxTQUFQO0FBT0Q7O0FBQ0QsYUFBTztBQUFFa0IsUUFBQUEsY0FBYyxFQUFFO0FBQWxCLE9BQVA7QUFDRDs7O0VBbkJpQ1MsZ0I7OztlQXFJckJsQyxjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XHJcbmltcG9ydCB7IEJveCB9IGZyb20gJ2dyaWQtc3R5bGVkJztcclxuaW1wb3J0IHsgY29tcG9uZW50cyB9IGZyb20gJ3JlYWN0LXNlbGVjdCc7XHJcblxyXG4vKiogSW1hZ2UgKi9cclxuXHJcbmltcG9ydCB7IFN2Z0FkZCB9IGZyb20gJy4uL0ljb25zL1N2Z0FkZCc7XHJcbmltcG9ydCB7IFN2Z0RlbGV0ZSB9IGZyb20gJy4uL0ljb25zL1N2Z0RlbGV0ZSc7XHJcblxyXG4vKiogdmlldyAqL1xyXG5pbXBvcnQgQnV0dG9uQmFzZSBmcm9tICcuLi9CdXR0b25CYXNlL0J1dHRvbkJhc2UnO1xyXG5pbXBvcnQgVGV4dCBmcm9tICcuLi9UZXh0L1RleHQnO1xyXG5pbXBvcnQgRmxleCBmcm9tICcuLi9GbGV4L0ZsZXgnO1xyXG5pbXBvcnQgeyBTZWxlY3RCYXNlLCBTZWxlY3RTdHlsZXMgfSBmcm9tICdAbGliL3VpL1NlbGVjdEJhc2UvU2VsZWN0QmFzZSc7XHJcbmltcG9ydCBEZWVwRXF1YWwgZnJvbSAnZmFzdC1kZWVwLWVxdWFsJztcclxuXHJcbmNvbnN0IEZsZXhTdHlsZWQgPSBzdHlsZWQoRmxleClgXHJcbiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICMwMDY0OWM7XHJcbiAgYm9yZGVyLXJhZGl1czogMHB4O1xyXG5gO1xyXG5cclxuY29uc3QgTmV3U2VsZWN0U3R5bGVzID0ge1xyXG4gIC4uLlNlbGVjdFN0eWxlcyxcclxuICBjb250cm9sOiAoc3R5bGUsIHByb3BzKSA9PiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5zdHlsZSxcclxuICAgICAgd2lkdGg6ICcxMDAlJyxcclxuICAgICAgcGFkZGluZzogJzAgMCAwIDEwcHgnLFxyXG4gICAgICBib3JkZXI6ICdub25lJyxcclxuICAgICAgYm9yZGVyUmFkaXVzOiAwLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgJzpob3Zlcic6IHtcclxuICAgICAgICBib3JkZXI6ICdub25lJyxcclxuICAgICAgICBib3hTaGFkb3c6ICdub25lJyxcclxuICAgICAgfSxcclxuICAgICAgLi4uKHByb3BzLmlzRm9jdXNlZFxyXG4gICAgICAgID8ge1xyXG4gICAgICAgICAgICBib3JkZXI6ICdub25lJyxcclxuICAgICAgICAgICAgYm94U2hhZG93OiAnbm9uZScsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgOiB7fSksXHJcbiAgICAgIC4uLihwcm9wcy5tZW51SXNPcGVuXHJcbiAgICAgICAgPyB7XHJcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzAnLFxyXG4gICAgICAgICAgICBib3JkZXI6ICdub25lJyxcclxuICAgICAgICAgIH1cclxuICAgICAgICA6IHt9KSxcclxuICAgIH07XHJcbiAgfSxcclxuICBtZW51OiBzdHlsZSA9PiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5zdHlsZSxcclxuICAgICAgbWFyZ2luOiAwLFxyXG4gICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLFxyXG4gICAgfTtcclxuICB9LFxyXG59O1xyXG5cclxuY29uc3QgQ29udHJvbENvbXBvbmVudCA9IHByb3BzID0+IChcclxuICA8RmxleFN0eWxlZCBweT17Mn0gYWxpZ25JdGVtcz17J2NlbnRlcid9IGp1c3RpZnlDb250ZW50PXsnc3BhY2UtYmV0d2Vlbid9IHdpZHRoPXsnMTAwJSd9PlxyXG4gICAgPFN2Z0FkZCAvPlxyXG4gICAgPGNvbXBvbmVudHMuQ29udHJvbCB7Li4ucHJvcHN9IC8+XHJcbiAgPC9GbGV4U3R5bGVkPlxyXG4pO1xyXG5cclxuLyoqXHJcbiAqINCa0L7QvNC/0L7QvdC10L3RgiDQuNC90L/Rg9GC0LAgYyDQtNC+0LDQsdCy0LvQtdC90LjQtdC8INC10YnQtSDQuNC90L/Rg9GC0L7QsiAoVGV4dCBGaWVsZCBBcnJheSlcclxuICogQGV4YW1wbGUgLi9UZXh0RmllbGRBcnJheS5leGFtcGxlLm1kXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgVGV4dEZpZWxkQXJyYXkgZXh0ZW5kcyBDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5pbml0aWFsU3RhdGU7XHJcbiAgfVxyXG5cclxuICBnZXQgaW5pdGlhbFN0YXRlKCkge1xyXG4gICAgaWYgKHRoaXMucHJvcHMuaW5wdXQudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IHsgb3B0aW9ucywgdmFsdWVLZXksIGlucHV0IH0gPSB0aGlzLnByb3BzO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzZWxlY3RlZE9wdGlvbjpcclxuICAgICAgICAgIG9wdGlvbnMgJiZcclxuICAgICAgICAgIG9wdGlvbnMuZmlsdGVyKG9wdGlvbkl0ZW0gPT5cclxuICAgICAgICAgICAgaW5wdXQudmFsdWUuZmluZCh2YWx1ZUl0ZW0gPT4gdmFsdWVJdGVtID09PSBvcHRpb25JdGVtW3ZhbHVlS2V5XSksXHJcbiAgICAgICAgICApLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgc2VsZWN0ZWRPcHRpb246IFtdIH07XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xyXG4gICAgaWYgKFxyXG4gICAgICAhRGVlcEVxdWFsKG5leHRQcm9wcy5vcHRpb25zLCB0aGlzLnByb3BzLm9wdGlvbnMpIHx8XHJcbiAgICAgICFEZWVwRXF1YWwobmV4dFByb3BzLmlucHV0LnZhbHVlLCB0aGlzLnByb3BzLmlucHV0LnZhbHVlKVxyXG4gICAgKSB7XHJcbiAgICAgIGNvbnN0IHsgb3B0aW9ucywgdmFsdWVLZXksIGlucHV0IH0gPSBuZXh0UHJvcHM7XHJcbiAgICAgIGlmIChpbnB1dC52YWx1ZSAmJiBvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0ZWRPcHRpb246XHJcbiAgICAgICAgICAgIG9wdGlvbnMgJiZcclxuICAgICAgICAgICAgb3B0aW9ucy5maWx0ZXIob3B0aW9uSXRlbSA9PlxyXG4gICAgICAgICAgICAgIGlucHV0LnZhbHVlLmZpbmQodmFsdWVJdGVtID0+IHZhbHVlSXRlbSA9PT0gb3B0aW9uSXRlbVt2YWx1ZUtleV0pLFxyXG4gICAgICAgICAgICApLFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25EZWxldGUgPSB2YWx1ZSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGlucHV0IH0gPSB0aGlzLnByb3BzO1xyXG4gICAgICBpbnB1dC5vbkNoYW5nZSh0aGlzLmNvbXBhcmVPcHRpb25zKGlucHV0LnZhbHVlLCBbdmFsdWVdKSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBvbkRlbGV0ZTogJywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIG9uQ2hhbmdlID0gdmFsdWUgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dCwgdmFsdWVLZXkgfSA9IHRoaXMucHJvcHM7XHJcbiAgICBpbnB1dC5vbkNoYW5nZShbLi4uaW5wdXQudmFsdWUsIHZhbHVlW3ZhbHVlS2V5XV0pO1xyXG4gIH07XHJcblxyXG4gIGNvbXBhcmVPcHRpb25zID0gKG9wdGlvbnMxID0gW10sIG9wdGlvbnMyID0gW10sIHZhbHVlS2V5KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zMSkgJiYgQXJyYXkuaXNBcnJheShvcHRpb25zMikpIHtcclxuICAgICAgICByZXR1cm4gb3B0aW9uczEuZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IG9wdGlvbnMyLmZpbmQoY2hpbGQgPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWVLZXkgJiYgdHlwZW9mIHZhbHVlS2V5ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgIHJldHVybiBpdGVtW3ZhbHVlS2V5XSA9PT0gY2hpbGQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gPT09IGNoaWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBnZXRPcHRpb25OYW1lID0gKG9wdGlvbnMsIGlkKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcmVzdWx0ID0gb3B0aW9ucyAmJiBBcnJheS5pc0FycmF5KG9wdGlvbnMpICYmIG9wdGlvbnMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGlkKTtcclxuICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybiByZXN1bHQubmFtZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgb3B0aW9ucyxcclxuICAgICAgaW5wdXQ6IHsgdmFsdWUgfSxcclxuICAgICAgdmFsdWVLZXksXHJcbiAgICB9ID0gdGhpcy5wcm9wcztcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8Qm94IHdpZHRoPXsnMTAwJSd9PlxyXG4gICAgICAgIHt2YWx1ZSAmJlxyXG4gICAgICAgICAgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiZcclxuICAgICAgICAgIHZhbHVlLm1hcCgoaXRlbSwgaW5kZXgpID0+IChcclxuICAgICAgICAgICAgPEZsZXhTdHlsZWQgcHk9ezN9IGtleT17YEZsZXhTdHlsZWQtJHtpbmRleH1gfSB3aWR0aD17JzEwMCUnfSBhbGlnbkl0ZW1zPXsnY2VudGVyJ30+XHJcbiAgICAgICAgICAgICAgPEJ1dHRvbkJhc2Ugb25DbGljaz17KCkgPT4gdGhpcy5vbkRlbGV0ZShpdGVtKX0gdHlwZT17J2J1dHRvbid9IHZhcmlhbnQ9eydlbXB0eSd9PlxyXG4gICAgICAgICAgICAgICAgPFN2Z0RlbGV0ZSAvPlxyXG4gICAgICAgICAgICAgIDwvQnV0dG9uQmFzZT5cclxuICAgICAgICAgICAgICA8VGV4dFxyXG4gICAgICAgICAgICAgICAgdGV4dEFsaWduPXsnY2VudGVyJ31cclxuICAgICAgICAgICAgICAgIHdpZHRoPXsnMTAwJSd9XHJcbiAgICAgICAgICAgICAgICBmb250U2l6ZT17Nn1cclxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ9ezh9XHJcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5PXsncHJpbWFyeTMwMCd9XHJcbiAgICAgICAgICAgICAgICBjb2xvcj17J2NvbG9yMyd9PlxyXG4gICAgICAgICAgICAgICAge3RoaXMuZ2V0T3B0aW9uTmFtZShvcHRpb25zLCBpdGVtKX1cclxuICAgICAgICAgICAgICA8L1RleHQ+XHJcbiAgICAgICAgICAgIDwvRmxleFN0eWxlZD5cclxuICAgICAgICAgICkpfVxyXG5cclxuICAgICAgICA8U2VsZWN0QmFzZVxyXG4gICAgICAgICAgcGxhY2Vob2xkZXI9eyfQlNC+0LHQsNCy0LjRgtGMINC90L7QstC+0LPQviDRgdC+0LPQu9Cw0YHRg9GO0YnQtdCz0L4nfVxyXG4gICAgICAgICAgey4uLnRoaXMucHJvcHN9XHJcbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX1cclxuICAgICAgICAgIG9wdGlvbnM9e3RoaXMuY29tcGFyZU9wdGlvbnMob3B0aW9ucywgdmFsdWUsIHZhbHVlS2V5KX1cclxuICAgICAgICAgIHN0eWxlcz17TmV3U2VsZWN0U3R5bGVzfVxyXG4gICAgICAgICAgY29tcG9uZW50cz17eyBDb250cm9sOiBDb250cm9sQ29tcG9uZW50IH19XHJcbiAgICAgICAgLz5cclxuICAgICAgPC9Cb3g+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVGV4dEZpZWxkQXJyYXk7XHJcbiJdfQ==