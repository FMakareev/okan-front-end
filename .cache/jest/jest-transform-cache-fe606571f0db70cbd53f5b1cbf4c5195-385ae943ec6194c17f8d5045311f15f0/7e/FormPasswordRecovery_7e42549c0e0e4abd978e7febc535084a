d3eec6b5d54a88d30bcfc06d6308a40a
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reduxForm = require("redux-form");

var _reactApollo = require("react-apollo");

var _reactRouterDom = require("react-router-dom");

var _reactRedux = require("react-redux");

var _reactNotificationSystemRedux = require("react-notification-system-redux");

var _withSentry = require("../../../../hocs/withSentry/withSentry");

var _Box = _interopRequireDefault(require("@lib/ui/Box/Box"));

var _TooltipBase = _interopRequireDefault(require("@lib/ui/TooltipBase/TooltipBase"));

var _FormButtonSubmit = _interopRequireDefault(require("@lib/ui/FormButtonSubmit/FormButtonSubmit"));

var _FieldInputPassword = _interopRequireDefault(require("../FieldInputPassword/FieldInputPassword"));

var _FormLogo = _interopRequireDefault(require("../FormLogo/FormLogo"));

var _FormPropTypes = require("../../../../propTypes/Forms/FormPropTypes");

var _UserPasswordRecoveryMutation = _interopRequireDefault(require("./UserPasswordRecoveryMutation.graphql"));

var _TextFieldLastWrapper = require("@lib/ui/TextFieldLastWrapper/TextFieldLastWrapper");

var _TextFieldFirstWrapper = require("@lib/ui/TextFieldFirstWrapper/TextFieldFirstWrapper");

/** View */

/** Components */

/** PropTypes */

/** GraphQl schema */
var validate = function validate(_ref) {
  var password = _ref.password,
      newpassword = _ref.newpassword,
      confirmnewpassword = _ref.confirmnewpassword;
  var errors = {};

  if (!password) {
    errors.password = 'Обязательно для заполнения';
  }

  if (!newpassword) {
    errors.newpassword = 'Обязательно для заполнения';
  }

  if (!confirmnewpassword) {
    errors.confirmnewpassword = 'Обязательно для заполнения';
  }

  if (newpassword !== undefined && newpassword.length <= 7) {
    errors.newpassword = 'Пароль должен состоять минимум из 8 символов';
  }

  if (newpassword !== undefined && newpassword.length >= 30) {
    errors.newpassword = 'Пароль должен состоять не больше 30 символов';
  }

  if (password === newpassword) {
    errors.newpassword = 'Старый пароль и новый пароль не должны совпадать';
  }

  if (confirmnewpassword !== newpassword) {
    errors.confirmnewpassword = 'Пароли не совпадают';
  }

  return errors;
};

var notificationOpts = function notificationOpts() {
  return {
    success: {
      title: 'Пароль успешно изменён',
      message: 'Пароль успешно изменён',
      position: 'tr',
      autoDismiss: 2
    },
    error: {
      title: 'Пароль не изменён',
      message: 'Пароль не изменён',
      position: 'tr',
      autoDismiss: 2
    }
  };
};

var FormPasswordRecovery =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(FormPasswordRecovery, _Component);

  function FormPasswordRecovery(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, FormPasswordRecovery);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(FormPasswordRecovery).call(this, props));
    _this.state = _this.initialState;
    _this.submit = _this.submit.bind((0, _assertThisInitialized2["default"])(_this));
    return _this;
  }

  (0, _createClass2["default"])(FormPasswordRecovery, [{
    key: "submit",
    value: function submit(value) {
      var _this2 = this;

      var data = {
        variables: Object.assign({}, value)
      };
      this.setState(function () {
        return {
          isLoading: true,
          submitting: true
        };
      });
      return this.props['@apollo/update'](data).then(function (response) {
        if (response.errors) {
          throw response;
        } else {
          _this2.props.reset();

          _this2.props.setNotificationSuccess(notificationOpts().success);

          _this2.props.history.push("/app/profile");

          return Promise.resolve(response);
        }
      })["catch"](function (error) {
        var errors = error.errors,
            message = error.message;

        _this2.props.setNotificationError(notificationOpts().error);

        (0, _withSentry.captureException)(error);

        _this2.setState(function () {
          return {
            submitting: false,
            apolloError: 'Ошибка смена пароля',
            isLoading: false
          };
        });
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          handleSubmit = _this$props.handleSubmit,
          pristine = _this$props.pristine,
          invalid = _this$props.invalid,
          error = _this$props.error;
      var _this$state = this.state,
          isLoading = _this$state.isLoading,
          apolloError = _this$state.apolloError,
          submitting = _this$state.submitting;
      return _react["default"].createElement(_reduxForm.Form, {
        onSubmit: handleSubmit(this.submit)
      }, _react["default"].createElement(_FormLogo["default"], null), _react["default"].createElement(_Box["default"], {
        mb: '100px'
      }, _react["default"].createElement(_TextFieldFirstWrapper.TextFieldFirstWrapper, null, _react["default"].createElement(_reduxForm.Field, {
        name: 'password',
        placeholder: 'Старый пароль',
        component: _FieldInputPassword["default"]
      })), _react["default"].createElement(_reduxForm.Field, {
        name: 'newpassword',
        placeholder: 'Новый пароль',
        variant: 'secondary',
        component: _FieldInputPassword["default"]
      }), _react["default"].createElement(_TextFieldLastWrapper.TextFieldLastWrapper, null, _react["default"].createElement(_reduxForm.Field, {
        name: 'confirmnewpassword',
        placeholder: 'Потвердите новый пароль',
        component: _FieldInputPassword["default"]
      }))), _react["default"].createElement(_FormButtonSubmit["default"], {
        disabled: pristine || submitting || invalid,
        ml: 9,
        isLoading: isLoading,
        error: error || apolloError
      }, _react["default"].createElement(_TooltipBase["default"], {
        isActive: error,
        warning: error
      }, "\u0421\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u0430\u0440\u043E\u043B\u044C")));
    }
  }, {
    key: "initialState",
    get: function get() {
      return {
        submitting: false,
        apolloError: null,
        isLoading: false
      };
    }
  }]);
  return FormPasswordRecovery;
}(_react.Component);

(0, _defineProperty2["default"])(FormPasswordRecovery, "propTypes", (0, _objectSpread2["default"])({}, _FormPropTypes.formPropTypes));
FormPasswordRecovery = (0, _reactRouterDom.withRouter)(FormPasswordRecovery);
FormPasswordRecovery = (0, _reactApollo.graphql)(_UserPasswordRecoveryMutation["default"], {
  name: '@apollo/update'
})(FormPasswordRecovery);
FormPasswordRecovery = (0, _reactRedux.connect)(null, function (dispatch) {
  return {
    setNotificationSuccess: function setNotificationSuccess(message) {
      return dispatch((0, _reactNotificationSystemRedux.success)(message));
    },
    setNotificationError: function setNotificationError(message) {
      return dispatch((0, _reactNotificationSystemRedux.error)(message));
    }
  };
})(FormPasswordRecovery);
FormPasswordRecovery = (0, _reduxForm.reduxForm)({
  form: 'FormPasswordRecovery',
  validate: validate
})(FormPasswordRecovery);
var _default = FormPasswordRecovery;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZvcm1QYXNzd29yZFJlY292ZXJ5LmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicGFzc3dvcmQiLCJuZXdwYXNzd29yZCIsImNvbmZpcm1uZXdwYXNzd29yZCIsImVycm9ycyIsInVuZGVmaW5lZCIsImxlbmd0aCIsIm5vdGlmaWNhdGlvbk9wdHMiLCJzdWNjZXNzIiwidGl0bGUiLCJtZXNzYWdlIiwicG9zaXRpb24iLCJhdXRvRGlzbWlzcyIsImVycm9yIiwiRm9ybVBhc3N3b3JkUmVjb3ZlcnkiLCJwcm9wcyIsInN0YXRlIiwiaW5pdGlhbFN0YXRlIiwic3VibWl0IiwiYmluZCIsInZhbHVlIiwiZGF0YSIsInZhcmlhYmxlcyIsIk9iamVjdCIsImFzc2lnbiIsInNldFN0YXRlIiwiaXNMb2FkaW5nIiwic3VibWl0dGluZyIsInRoZW4iLCJyZXNwb25zZSIsInJlc2V0Iiwic2V0Tm90aWZpY2F0aW9uU3VjY2VzcyIsImhpc3RvcnkiLCJwdXNoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXROb3RpZmljYXRpb25FcnJvciIsImFwb2xsb0Vycm9yIiwiaGFuZGxlU3VibWl0IiwicHJpc3RpbmUiLCJpbnZhbGlkIiwiRmllbGRJbnB1dFBhc3N3b3JkIiwiQ29tcG9uZW50IiwiZm9ybVByb3BUeXBlcyIsIlVzZXJQYXNzd29yZFJlY292ZXJ5TXV0YXRpb24iLCJuYW1lIiwiZGlzcGF0Y2giLCJmb3JtIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFHQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFmQTs7QUFLQTs7QUFJQTs7QUFHQTtBQUtBLElBQU1BLFFBQVEsR0FBRyxTQUFYQSxRQUFXLE9BQW1EO0FBQUEsTUFBaERDLFFBQWdELFFBQWhEQSxRQUFnRDtBQUFBLE1BQXRDQyxXQUFzQyxRQUF0Q0EsV0FB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O0FBQUEsS0FEcEI7QUFFWDBCLElBQUFBLG9CQUFvQixFQUFFLDhCQUFBMUIsT0FBTztBQUFBLGFBQUlvQyxRQUFRLENBQUMseUNBQU1wQyxPQUFOLENBQUQsQ0FBWjtBQUFBO0FBRmxCLEdBQUw7QUFBQSxDQUZhLEVBTXJCSSxvQkFOcUIsQ0FBdkI7QUFRQUEsb0JBQW9CLEdBQUcsMEJBQVU7QUFDL0JpQyxFQUFBQSxJQUFJLEVBQUUsc0JBRHlCO0FBRS9CL0MsRUFBQUEsUUFBUSxFQUFSQTtBQUYrQixDQUFWLEVBR3BCYyxvQkFIb0IsQ0FBdkI7ZUFLZUEsb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyBGaWVsZCwgcmVkdXhGb3JtLCBGb3JtIH0gZnJvbSAncmVkdXgtZm9ybSc7XHJcbmltcG9ydCB7IGdyYXBocWwgfSBmcm9tICdyZWFjdC1hcG9sbG8nO1xyXG5pbXBvcnQgeyB3aXRoUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XHJcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7XHJcbmltcG9ydCB7IHN1Y2Nlc3MsIGVycm9yIH0gZnJvbSAncmVhY3Qtbm90aWZpY2F0aW9uLXN5c3RlbS1yZWR1eCc7XHJcbmltcG9ydCB7IGNhcHR1cmVFeGNlcHRpb24gfSBmcm9tICcuLi8uLi8uLi8uLi9ob2NzL3dpdGhTZW50cnkvd2l0aFNlbnRyeSc7XHJcblxyXG4vKiogVmlldyAqL1xyXG5pbXBvcnQgQm94IGZyb20gJ0BsaWIvdWkvQm94L0JveCc7XHJcbmltcG9ydCBUb29sdGlwQmFzZSBmcm9tICdAbGliL3VpL1Rvb2x0aXBCYXNlL1Rvb2x0aXBCYXNlJztcclxuaW1wb3J0IEZvcm1CdXR0b25TdWJtaXQgZnJvbSAnQGxpYi91aS9Gb3JtQnV0dG9uU3VibWl0L0Zvcm1CdXR0b25TdWJtaXQnO1xyXG5cclxuLyoqIENvbXBvbmVudHMgKi9cclxuaW1wb3J0IEZpZWxkSW5wdXRQYXNzd29yZCBmcm9tICcuLi9GaWVsZElucHV0UGFzc3dvcmQvRmllbGRJbnB1dFBhc3N3b3JkJztcclxuaW1wb3J0IEZvcm1Mb2dvIGZyb20gJy4uL0Zvcm1Mb2dvL0Zvcm1Mb2dvJztcclxuXHJcbi8qKiBQcm9wVHlwZXMgKi9cclxuaW1wb3J0IHsgZm9ybVByb3BUeXBlcyB9IGZyb20gJy4uLy4uLy4uLy4uL3Byb3BUeXBlcy9Gb3Jtcy9Gb3JtUHJvcFR5cGVzJztcclxuXHJcbi8qKiBHcmFwaFFsIHNjaGVtYSAqL1xyXG5pbXBvcnQgVXNlclBhc3N3b3JkUmVjb3ZlcnlNdXRhdGlvbiBmcm9tICcuL1VzZXJQYXNzd29yZFJlY292ZXJ5TXV0YXRpb24uZ3JhcGhxbCc7XHJcbmltcG9ydCB7IFRleHRGaWVsZExhc3RXcmFwcGVyIH0gZnJvbSAnQGxpYi91aS9UZXh0RmllbGRMYXN0V3JhcHBlci9UZXh0RmllbGRMYXN0V3JhcHBlcic7XHJcbmltcG9ydCB7IFRleHRGaWVsZEZpcnN0V3JhcHBlciB9IGZyb20gJ0BsaWIvdWkvVGV4dEZpZWxkRmlyc3RXcmFwcGVyL1RleHRGaWVsZEZpcnN0V3JhcHBlcic7XHJcblxyXG5jb25zdCB2YWxpZGF0ZSA9ICh7IHBhc3N3b3JkLCBuZXdwYXNzd29yZCwgY29uZmlybW5ld3Bhc3N3b3JkIH0pID0+IHtcclxuICBjb25zdCBlcnJvcnMgPSB7fTtcclxuXHJcbiAgaWYgKCFwYXNzd29yZCkge1xyXG4gICAgZXJyb3JzLnBhc3N3b3JkID0gJ9Ce0LHRj9C30LDRgtC10LvRjNC90L4g0LTQu9GPINC30LDQv9C+0LvQvdC10L3QuNGPJztcclxuICB9XHJcblxyXG4gIGlmICghbmV3cGFzc3dvcmQpIHtcclxuICAgIGVycm9ycy5uZXdwYXNzd29yZCA9ICfQntCx0Y/Qt9Cw0YLQtdC70YzQvdC+INC00LvRjyDQt9Cw0L/QvtC70L3QtdC90LjRjyc7XHJcbiAgfVxyXG5cclxuICBpZiAoIWNvbmZpcm1uZXdwYXNzd29yZCkge1xyXG4gICAgZXJyb3JzLmNvbmZpcm1uZXdwYXNzd29yZCA9ICfQntCx0Y/Qt9Cw0YLQtdC70YzQvdC+INC00LvRjyDQt9Cw0L/QvtC70L3QtdC90LjRjyc7XHJcbiAgfVxyXG5cclxuICBpZiAobmV3cGFzc3dvcmQgIT09IHVuZGVmaW5lZCAmJiBuZXdwYXNzd29yZC5sZW5ndGggPD0gNykge1xyXG4gICAgZXJyb3JzLm5ld3Bhc3N3b3JkID0gJ9Cf0LDRgNC+0LvRjCDQtNC+0LvQttC10L0g0YHQvtGB0YLQvtGP0YLRjCDQvNC40L3QuNC80YPQvCDQuNC3IDgg0YHQuNC80LLQvtC70L7Qsic7XHJcbiAgfVxyXG5cclxuICBpZiAobmV3cGFzc3dvcmQgIT09IHVuZGVmaW5lZCAmJiBuZXdwYXNzd29yZC5sZW5ndGggPj0gMzApIHtcclxuICAgIGVycm9ycy5uZXdwYXNzd29yZCA9ICfQn9Cw0YDQvtC70Ywg0LTQvtC70LbQtdC9INGB0L7RgdGC0L7Rj9GC0Ywg0L3QtSDQsdC+0LvRjNGI0LUgMzAg0YHQuNC80LLQvtC70L7Qsic7XHJcbiAgfVxyXG5cclxuICBpZiAocGFzc3dvcmQgPT09IG5ld3Bhc3N3b3JkKSB7XHJcbiAgICBlcnJvcnMubmV3cGFzc3dvcmQgPSAn0KHRgtCw0YDRi9C5INC/0LDRgNC+0LvRjCDQuCDQvdC+0LLRi9C5INC/0LDRgNC+0LvRjCDQvdC1INC00L7Qu9C20L3RiyDRgdC+0LLQv9Cw0LTQsNGC0YwnO1xyXG4gIH1cclxuXHJcbiAgaWYgKGNvbmZpcm1uZXdwYXNzd29yZCAhPT0gbmV3cGFzc3dvcmQpIHtcclxuICAgIGVycm9ycy5jb25maXJtbmV3cGFzc3dvcmQgPSAn0J/QsNGA0L7Qu9C4INC90LUg0YHQvtCy0L/QsNC00LDRjtGCJztcclxuICB9XHJcbiAgcmV0dXJuIGVycm9ycztcclxufTtcclxuXHJcbmNvbnN0IG5vdGlmaWNhdGlvbk9wdHMgPSAoKSA9PiAoe1xyXG4gIHN1Y2Nlc3M6IHtcclxuICAgIHRpdGxlOiAn0J/QsNGA0L7Qu9GMINGD0YHQv9C10YjQvdC+INC40LfQvNC10L3RkdC9JyxcclxuICAgIG1lc3NhZ2U6ICfQn9Cw0YDQvtC70Ywg0YPRgdC/0LXRiNC90L4g0LjQt9C80LXQvdGR0L0nLFxyXG4gICAgcG9zaXRpb246ICd0cicsXHJcbiAgICBhdXRvRGlzbWlzczogMixcclxuICB9LFxyXG4gIGVycm9yOiB7XHJcbiAgICB0aXRsZTogJ9Cf0LDRgNC+0LvRjCDQvdC1INC40LfQvNC10L3RkdC9JyxcclxuICAgIG1lc3NhZ2U6ICfQn9Cw0YDQvtC70Ywg0L3QtSDQuNC30LzQtdC90ZHQvScsXHJcbiAgICBwb3NpdGlvbjogJ3RyJyxcclxuICAgIGF1dG9EaXNtaXNzOiAyLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuY2xhc3MgRm9ybVBhc3N3b3JkUmVjb3ZlcnkgZXh0ZW5kcyBDb21wb25lbnQge1xyXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XHJcbiAgICAuLi5mb3JtUHJvcFR5cGVzLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcblxyXG4gICAgdGhpcy5zdGF0ZSA9IHRoaXMuaW5pdGlhbFN0YXRlO1xyXG5cclxuICAgIHRoaXMuc3VibWl0ID0gdGhpcy5zdWJtaXQuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIGdldCBpbml0aWFsU3RhdGUoKSB7XHJcbiAgICByZXR1cm4geyBzdWJtaXR0aW5nOiBmYWxzZSwgYXBvbGxvRXJyb3I6IG51bGwsIGlzTG9hZGluZzogZmFsc2UgfTtcclxuICB9XHJcblxyXG4gIHN1Ym1pdCh2YWx1ZSkge1xyXG4gICAgY29uc3QgZGF0YSA9IHsgdmFyaWFibGVzOiBPYmplY3QuYXNzaWduKHt9LCB2YWx1ZSkgfTtcclxuXHJcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7IGlzTG9hZGluZzogdHJ1ZSwgc3VibWl0dGluZzogdHJ1ZSB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucHJvcHNbJ0BhcG9sbG8vdXBkYXRlJ10oZGF0YSlcclxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcnMpIHtcclxuICAgICAgICAgIHRocm93IHJlc3BvbnNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnByb3BzLnJlc2V0KCk7XHJcbiAgICAgICAgICB0aGlzLnByb3BzLnNldE5vdGlmaWNhdGlvblN1Y2Nlc3Mobm90aWZpY2F0aW9uT3B0cygpLnN1Y2Nlc3MpO1xyXG4gICAgICAgICAgdGhpcy5wcm9wcy5oaXN0b3J5LnB1c2goYC9hcHAvcHJvZmlsZWApO1xyXG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyBlcnJvcnMsIG1lc3NhZ2UgfSA9IGVycm9yO1xyXG4gICAgICAgIHRoaXMucHJvcHMuc2V0Tm90aWZpY2F0aW9uRXJyb3Iobm90aWZpY2F0aW9uT3B0cygpLmVycm9yKTtcclxuICAgICAgICBjYXB0dXJlRXhjZXB0aW9uKGVycm9yKTtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XHJcbiAgICAgICAgICBzdWJtaXR0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGFwb2xsb0Vycm9yOiAn0J7RiNC40LHQutCwINGB0LzQtdC90LAg0L/QsNGA0L7Qu9GPJyxcclxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHsgaGFuZGxlU3VibWl0LCBwcmlzdGluZSwgaW52YWxpZCwgZXJyb3IgfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCB7IGlzTG9hZGluZywgYXBvbGxvRXJyb3IsIHN1Ym1pdHRpbmcgfSA9IHRoaXMuc3RhdGU7XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPEZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdCh0aGlzLnN1Ym1pdCl9PlxyXG4gICAgICAgIDxGb3JtTG9nbyAvPlxyXG5cclxuICAgICAgICA8Qm94IG1iPXsnMTAwcHgnfT5cclxuICAgICAgICAgIDxUZXh0RmllbGRGaXJzdFdyYXBwZXI+XHJcbiAgICAgICAgICAgIDxGaWVsZCBuYW1lPXsncGFzc3dvcmQnfSBwbGFjZWhvbGRlcj17J9Ch0YLQsNGA0YvQuSDQv9Cw0YDQvtC70YwnfSBjb21wb25lbnQ9e0ZpZWxkSW5wdXRQYXNzd29yZH0gLz5cclxuICAgICAgICAgIDwvVGV4dEZpZWxkRmlyc3RXcmFwcGVyPlxyXG5cclxuICAgICAgICAgIDxGaWVsZFxyXG4gICAgICAgICAgICBuYW1lPXsnbmV3cGFzc3dvcmQnfVxyXG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17J9Cd0L7QstGL0Lkg0L/QsNGA0L7Qu9GMJ31cclxuICAgICAgICAgICAgdmFyaWFudD17J3NlY29uZGFyeSd9XHJcbiAgICAgICAgICAgIGNvbXBvbmVudD17RmllbGRJbnB1dFBhc3N3b3JkfVxyXG4gICAgICAgICAgLz5cclxuXHJcbiAgICAgICAgICA8VGV4dEZpZWxkTGFzdFdyYXBwZXI+XHJcbiAgICAgICAgICAgIDxGaWVsZFxyXG4gICAgICAgICAgICAgIG5hbWU9eydjb25maXJtbmV3cGFzc3dvcmQnfVxyXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXsn0J/QvtGC0LLQtdGA0LTQuNGC0LUg0L3QvtCy0YvQuSDQv9Cw0YDQvtC70YwnfVxyXG4gICAgICAgICAgICAgIGNvbXBvbmVudD17RmllbGRJbnB1dFBhc3N3b3JkfVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgPC9UZXh0RmllbGRMYXN0V3JhcHBlcj5cclxuICAgICAgICA8L0JveD5cclxuXHJcbiAgICAgICAgPEZvcm1CdXR0b25TdWJtaXRcclxuICAgICAgICAgIGRpc2FibGVkPXtwcmlzdGluZSB8fCBzdWJtaXR0aW5nIHx8IGludmFsaWR9XHJcbiAgICAgICAgICBtbD17OX1cclxuICAgICAgICAgIGlzTG9hZGluZz17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgZXJyb3I9e2Vycm9yIHx8IGFwb2xsb0Vycm9yfT5cclxuICAgICAgICAgIDxUb29sdGlwQmFzZSBpc0FjdGl2ZT17ZXJyb3J9IHdhcm5pbmc9e2Vycm9yfT5cclxuICAgICAgICAgICAg0KHQvNC10L3QuNGC0Ywg0L/QsNGA0L7Qu9GMXHJcbiAgICAgICAgICA8L1Rvb2x0aXBCYXNlPlxyXG4gICAgICAgIDwvRm9ybUJ1dHRvblN1Ym1pdD5cclxuICAgICAgPC9Gb3JtPlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbkZvcm1QYXNzd29yZFJlY292ZXJ5ID0gd2l0aFJvdXRlcihGb3JtUGFzc3dvcmRSZWNvdmVyeSk7XHJcblxyXG5Gb3JtUGFzc3dvcmRSZWNvdmVyeSA9IGdyYXBocWwoVXNlclBhc3N3b3JkUmVjb3ZlcnlNdXRhdGlvbiwge1xyXG4gIG5hbWU6ICdAYXBvbGxvL3VwZGF0ZScsXHJcbn0pKEZvcm1QYXNzd29yZFJlY292ZXJ5KTtcclxuXHJcbkZvcm1QYXNzd29yZFJlY292ZXJ5ID0gY29ubmVjdChcclxuICBudWxsLFxyXG4gIGRpc3BhdGNoID0+ICh7XHJcbiAgICBzZXROb3RpZmljYXRpb25TdWNjZXNzOiBtZXNzYWdlID0+IGRpc3BhdGNoKHN1Y2Nlc3MobWVzc2FnZSkpLFxyXG4gICAgc2V0Tm90aWZpY2F0aW9uRXJyb3I6IG1lc3NhZ2UgPT4gZGlzcGF0Y2goZXJyb3IobWVzc2FnZSkpLFxyXG4gIH0pLFxyXG4pKEZvcm1QYXNzd29yZFJlY292ZXJ5KTtcclxuXHJcbkZvcm1QYXNzd29yZFJlY292ZXJ5ID0gcmVkdXhGb3JtKHtcclxuICBmb3JtOiAnRm9ybVBhc3N3b3JkUmVjb3ZlcnknLFxyXG4gIHZhbGlkYXRlLFxyXG59KShGb3JtUGFzc3dvcmRSZWNvdmVyeSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGb3JtUGFzc3dvcmRSZWNvdmVyeTtcclxuIl19