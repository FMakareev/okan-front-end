{"version":3,"sources":["index.js"],"names":["has","Object","prototype","hasOwnProperty","notificationDocumentSettingsPage","error","title","message","position","autoDismiss","DocumentSettingsPage","approvalList","userList","newApprovalList","forEach","item","indexUser","findIndex","user","id","push","role","name","approvaldate","documentitem","setNotificationError","props","internalMatching","map","console","match","params","DocumentItemQuery","data","loading","call","createInitialValues","Component","ReactRoutePropTypes","state","dispatch","setNotificationSuccess"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Query } from 'react-apollo';\r\nimport { captureException } from '../../../../hocs/withSentry/withSentry';\r\n\r\n/** Redux user */\r\nimport { getUserFromStore } from '../../../../store/reducers/user/selectors';\r\n\r\n/**PropTypes */\r\nimport { ReactRoutePropTypes } from '../../../../propTypes/ReactRoutePropTypes';\r\n\r\n/** View */\r\nimport ErrorCatch from '@lib/ui/ErrorCatch/ErrorCatch';\r\n\r\n/** Components */\r\nimport FormDocumentSettings from '../../component/FormDocumentSettings/FormDocumentSettings';\r\n\r\n/** Graphql schema */\r\nimport DocumentItemQuery from '../../graphql/DocumentItemQuery.graphql';\r\nimport { error, success } from 'react-notification-system-redux';\r\n\r\nconst has = Object.prototype.hasOwnProperty;\r\n\r\nconst notificationDocumentSettingsPage = () => ({\r\n  error: {\r\n    title: 'Ошибка инициализации.',\r\n    message:\r\n      'Во время инициализации формы произошла ошибка, попробуйте перезагрузит страницу если это не поможет обратитесь в поддержку.',\r\n    position: 'tr',\r\n    autoDismiss: 2,\r\n  },\r\n});\r\n\r\nclass DocumentSettingsPage extends Component {\r\n  static propTypes = { ...ReactRoutePropTypes };\r\n\r\n  state = {};\r\n\r\n  /**\r\n   * @param {array} approvalList - список согласующиъ/утверждающих externalAndInternalApprove, externalMatching\r\n   * @param {array} userList - просто список пользователей\r\n   * @desc метод преобразует данные из списков externalAndInternalApprove, externalMatching в валидную для формы структуру\r\n   * */\r\n  createContractorApprovalList = (approvalList, userList) => {\r\n    const newApprovalList = [];\r\n    approvalList.forEach(item => {\r\n      const indexUser = userList.findIndex(user => user.id === item.user);\r\n      if (indexUser >= 0) {\r\n        newApprovalList.push({\r\n          user: {\r\n            ...userList[indexUser],\r\n            role: userList[indexUser].role.name,\r\n          },\r\n          approvaldate: item.approvaldate,\r\n        });\r\n      }\r\n    });\r\n    return newApprovalList;\r\n  };\r\n\r\n  /**\r\n   * @param {object} value\r\n   * @param {object} value.documentitem - данные иззапроса документа\r\n   * @return {object} возвращает объект с данными для формы\r\n   * @desc метод формирует объект для инициализации формы\r\n   * */\r\n  createInitialValues = ({ documentitem }) => {\r\n    const { setNotificationError } = this.props;\r\n\r\n    try {\r\n      return {\r\n        ...documentitem,\r\n        internalMatching: documentitem ? documentitem.internalMatching.map(item => item.id) : [],\r\n      };\r\n    } catch (error) {\r\n      captureException(error);\r\n      console.error('Error createInitialValues: ', error);\r\n      setNotificationError(notificationDocumentSettingsPage().error);\r\n      return {};\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      match: {\r\n        params: { id },\r\n      },\r\n    } = this.props;\r\n\r\n    return (\r\n      <ErrorCatch>\r\n        <Query query={DocumentItemQuery} variables={{ id: id }}>\r\n          {({ data, error, loading }) => {\r\n            if (loading) {\r\n              console.error('loading:', loading);\r\n              return 'Загрузка ...';\r\n            }\r\n            if (error) {\r\n              console.error('Error:', error);\r\n              return 'Ошибка ...';\r\n            }\r\n\r\n            if (!data || (data && !has.call(data, 'documentitem'))) {\r\n              return null;\r\n            }\r\n\r\n            return <FormDocumentSettings initialValues={this.createInitialValues(data)} />;\r\n          }}\r\n        </Query>\r\n      </ErrorCatch>\r\n    );\r\n  }\r\n}\r\n\r\nDocumentSettingsPage = connect(\r\n  state => ({\r\n    user: getUserFromStore(state),\r\n  }),\r\n  dispatch => ({\r\n    setNotificationSuccess: message => dispatch(success(message)),\r\n    setNotificationError: message => dispatch(error(message)),\r\n  }),\r\n)(DocumentSettingsPage);\r\n\r\nexport default DocumentSettingsPage;\r\n"]}