a54093631a18e8e19d480cbac0862085
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.ErrorCatch = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var Sentry = _interopRequireWildcard(require("@sentry/browser"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactRouterDom = require("react-router-dom");

var _GraphQLError = _interopRequireDefault(require("./GraphQLError"));

var _RenderError = _interopRequireDefault(require("../RenderError/RenderError"));

/**
 * Компонент ошибки
 * @example ./ErrorCatch.example.md
 */
var ErrorCatch =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(ErrorCatch, _Component);

  function ErrorCatch(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, ErrorCatch);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(ErrorCatch).call(this, props));
    _this.state = {
      error: null
    };
    _this.findOfTheTypeError = _this.findOfTheTypeError.bind((0, _assertThisInitialized2["default"])(_this));

    if (_this.props.error) {
      Sentry.withScope(function (scope) {
        Object.keys(_this.props.error).forEach(function (key) {
          scope.setExtra(key, _this.props.error[key]);
        });
        Sentry.captureException(_this.props.error);
      });

      _this.setState(function () {
        return {
          error: _this.props.error
        };
      });
    }

    return _this;
  }

  (0, _createClass2["default"])(ErrorCatch, [{
    key: "componentDidCatch",
    value: function componentDidCatch(error, errorInfo) {
      console.log(error, errorInfo);
      var Error = this.findOfTheTypeError(error);
      this.setState(function () {
        return {
          error: Error,
          info: errorInfo
        };
      });
      Sentry.withScope(function (scope) {
        Object.keys(errorInfo).forEach(function (key) {
          scope.setExtra(key, errorInfo[key]);
        });
        Sentry.captureException(error);
      });
    }
  }, {
    key: "findOfTheTypeError",
    value: function findOfTheTypeError(error) {
      if (error.message.indexOf('GraphQL error: ') >= 0) {
        return (0, _GraphQLError["default"])(error, this.props.translate);
      }

      if (error.message.indexOf('Network error: Failed to fetch') >= 0) {
        return {
          message: 'Network error: Failed to fetch',
          redirect: '/500'
        };
      }

      return error;
    }
  }, {
    key: "render",
    value: function render() {
      var children = this.props.children;
      var error = this.state.error;

      if (error) {
        if (error.redirect) {
          return _react["default"].createElement(_reactRouterDom.Redirect, {
            to: error.redirect
          });
        }

        return _react["default"].createElement("div", null, _react["default"].createElement(_RenderError["default"], error));
      }

      if (!children) {
        return null;
      }

      return children;
    }
  }]);
  return ErrorCatch;
}(_react.Component);

exports.ErrorCatch = ErrorCatch;
(0, _defineProperty2["default"])(ErrorCatch, "propTypes", {
  /** Children component */
  children: _propTypes["default"].element,

  /** notifications plugin: https://github.com/gor181/react-notification-system-redux */
  notifications: _propTypes["default"].array
});
(0, _defineProperty2["default"])(ErrorCatch, "defaultProps", {
  error: null
});
var _default = ErrorCatch;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkVycm9yQ2F0Y2guanMiXSwibmFtZXMiOlsiRXJyb3JDYXRjaCIsInByb3BzIiwic3RhdGUiLCJlcnJvciIsImZpbmRPZlRoZVR5cGVFcnJvciIsImJpbmQiLCJTZW50cnkiLCJ3aXRoU2NvcGUiLCJzY29wZSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5Iiwic2V0RXh0cmEiLCJjYXB0dXJlRXhjZXB0aW9uIiwic2V0U3RhdGUiLCJlcnJvckluZm8iLCJjb25zb2xlIiwibG9nIiwiRXJyb3IiLCJpbmZvIiwibWVzc2FnZSIsImluZGV4T2YiLCJ0cmFuc2xhdGUiLCJyZWRpcmVjdCIsImNoaWxkcmVuIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwiZWxlbWVudCIsIm5vdGlmaWNhdGlvbnMiLCJhcnJheSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7O0lBSWFBLFU7Ozs7O0FBWVgsc0JBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTtBQUNqQixzSEFBTUEsS0FBTjtBQUVBLFVBQUtDLEtBQUwsR0FBYTtBQUNYQyxNQUFBQSxLQUFLLEVBQUU7QUFESSxLQUFiO0FBR0EsVUFBS0Msa0JBQUwsR0FBMEIsTUFBS0Esa0JBQUwsQ0FBd0JDLElBQXhCLGdEQUExQjs7QUFDQSxRQUFJLE1BQUtKLEtBQUwsQ0FBV0UsS0FBZixFQUFzQjtBQUNwQkcsTUFBQUEsTUFBTSxDQUFDQyxTQUFQLENBQWlCLFVBQUFDLEtBQUssRUFBSTtBQUN4QkMsUUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVksTUFBS1QsS0FBTCxDQUFXRSxLQUF2QixFQUE4QlEsT0FBOUIsQ0FBc0MsVUFBQUMsR0FBRyxFQUFJO0FBQzNDSixVQUFBQSxLQUFLLENBQUNLLFFBQU4sQ0FBZUQsR0FBZixFQUFvQixNQUFLWCxLQUFMLENBQVdFLEtBQVgsQ0FBaUJTLEdBQWpCLENBQXBCO0FBQ0QsU0FGRDtBQUdBTixRQUFBQSxNQUFNLENBQUNRLGdCQUFQLENBQXdCLE1BQUtiLEtBQUwsQ0FBV0UsS0FBbkM7QUFDRCxPQUxEOztBQU1BLFlBQUtZLFFBQUwsQ0FBYztBQUFBLGVBQU87QUFDbkJaLFVBQUFBLEtBQUssRUFBRSxNQUFLRixLQUFMLENBQVdFO0FBREMsU0FBUDtBQUFBLE9BQWQ7QUFHRDs7QUFqQmdCO0FBa0JsQjs7OztzQ0FHaUJBLEssRUFBT2EsUyxFQUFXO0FBQ2xDQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWWYsS0FBWixFQUFtQmEsU0FBbkI7QUFFQSxVQUFNRyxLQUFLLEdBQUcsS0FBS2Ysa0JBQUwsQ0FBd0JELEtBQXhCLENBQWQ7QUFDQSxXQUFLWSxRQUFMLENBQWM7QUFBQSxlQUFPO0FBQ25CWixVQUFBQSxLQUFLLEVBQUVnQixLQURZO0FBRW5CQyxVQUFBQSxJQUFJLEVBQUVKO0FBRmEsU0FBUDtBQUFBLE9BQWQ7QUFJQVYsTUFBQUEsTUFBTSxDQUFDQyxTQUFQLENBQWlCLFVBQUFDLEtBQUssRUFBSTtBQUN4QkMsUUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVlNLFNBQVosRUFBdUJMLE9BQXZCLENBQStCLFVBQUFDLEdBQUcsRUFBSTtBQUNwQ0osVUFBQUEsS0FBSyxDQUFDSyxRQUFOLENBQWVELEdBQWYsRUFBb0JJLFNBQVMsQ0FBQ0osR0FBRCxDQUE3QjtBQUNELFNBRkQ7QUFHQU4sUUFBQUEsTUFBTSxDQUFDUSxnQkFBUCxDQUF3QlgsS0FBeEI7QUFDRCxPQUxEO0FBTUQ7Ozt1Q0FFa0JBLEssRUFBTztBQUN4QixVQUFJQSxLQUFLLENBQUNrQixPQUFOLENBQWNDLE9BQWQsQ0FBc0IsaUJBQXRCLEtBQTRDLENBQWhELEVBQW1EO0FBQ2pELGVBQU8sOEJBQWFuQixLQUFiLEVBQW9CLEtBQUtGLEtBQUwsQ0FBV3NCLFNBQS9CLENBQVA7QUFDRDs7QUFDRCxVQUFJcEIsS0FBSyxDQUFDa0IsT0FBTixDQUFjQyxPQUFkLENBQXNCLGdDQUF0QixLQUEyRCxDQUEvRCxFQUFrRTtBQUNoRSxlQUFPO0FBQ0xELFVBQUFBLE9BQU8sRUFBRSxnQ0FESjtBQUVMRyxVQUFBQSxRQUFRLEVBQUU7QUFGTCxTQUFQO0FBSUQ7O0FBQ0QsYUFBT3JCLEtBQVA7QUFDRDs7OzZCQUVRO0FBQUEsVUFDQXNCLFFBREEsR0FDWSxLQUFLeEIsS0FEakIsQ0FDQXdCLFFBREE7QUFBQSxVQUVBdEIsS0FGQSxHQUVTLEtBQUtELEtBRmQsQ0FFQUMsS0FGQTs7QUFHUCxVQUFJQSxLQUFKLEVBQVc7QUFDVCxZQUFJQSxLQUFLLENBQUNxQixRQUFWLEVBQW9CO0FBQ2xCLGlCQUFPLGdDQUFDLHdCQUFEO0FBQVUsWUFBQSxFQUFFLEVBQUVyQixLQUFLLENBQUNxQjtBQUFwQixZQUFQO0FBQ0Q7O0FBQ0QsZUFBTyw2Q0FDTCxnQ0FBQyx1QkFBRCxFQUFpQnJCLEtBQWpCLENBREssQ0FBUDtBQUdEOztBQUNELFVBQUksQ0FBQ3NCLFFBQUwsRUFBZTtBQUNiLGVBQU8sSUFBUDtBQUNEOztBQUNELGFBQU9BLFFBQVA7QUFDRDs7O0VBN0U2QkMsZ0I7OztpQ0FBbkIxQixVLGVBQ1E7QUFDakI7QUFDQXlCLEVBQUFBLFFBQVEsRUFBRUUsc0JBQVVDLE9BRkg7O0FBR2pCO0FBQ0FDLEVBQUFBLGFBQWEsRUFBRUYsc0JBQVVHO0FBSlIsQztpQ0FEUjlCLFUsa0JBUVc7QUFDcEJHLEVBQUFBLEtBQUssRUFBRTtBQURhLEM7ZUF3RVRILFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0ICogYXMgU2VudHJ5IGZyb20gJ0BzZW50cnkvYnJvd3Nlcic7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCB7UmVkaXJlY3R9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgR3JhcGhRTEVycm9yIGZyb20gJy4vR3JhcGhRTEVycm9yJztcclxuaW1wb3J0IFJlbmRlckVycm9yIGZyb20gJy4uL1JlbmRlckVycm9yL1JlbmRlckVycm9yJztcclxuXHJcbi8qKlxyXG4gKiDQmtC+0LzQv9C+0L3QtdC90YIg0L7RiNC40LHQutC4XHJcbiAqIEBleGFtcGxlIC4vRXJyb3JDYXRjaC5leGFtcGxlLm1kXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRXJyb3JDYXRjaCBleHRlbmRzIENvbXBvbmVudCB7XHJcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcclxuICAgIC8qKiBDaGlsZHJlbiBjb21wb25lbnQgKi9cclxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuZWxlbWVudCxcclxuICAgIC8qKiBub3RpZmljYXRpb25zIHBsdWdpbjogaHR0cHM6Ly9naXRodWIuY29tL2dvcjE4MS9yZWFjdC1ub3RpZmljYXRpb24tc3lzdGVtLXJlZHV4ICovXHJcbiAgICBub3RpZmljYXRpb25zOiBQcm9wVHlwZXMuYXJyYXksXHJcbiAgfTtcclxuXHJcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcclxuICAgIGVycm9yOiBudWxsLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcblxyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICB9O1xyXG4gICAgdGhpcy5maW5kT2ZUaGVUeXBlRXJyb3IgPSB0aGlzLmZpbmRPZlRoZVR5cGVFcnJvci5iaW5kKHRoaXMpO1xyXG4gICAgaWYgKHRoaXMucHJvcHMuZXJyb3IpIHtcclxuICAgICAgU2VudHJ5LndpdGhTY29wZShzY29wZSA9PiB7XHJcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5wcm9wcy5lcnJvcikuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgc2NvcGUuc2V0RXh0cmEoa2V5LCB0aGlzLnByb3BzLmVycm9yW2tleV0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFNlbnRyeS5jYXB0dXJlRXhjZXB0aW9uKHRoaXMucHJvcHMuZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiAoe1xyXG4gICAgICAgIGVycm9yOiB0aGlzLnByb3BzLmVycm9yLFxyXG4gICAgICB9KSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IsIGVycm9ySW5mbyk7XHJcblxyXG4gICAgY29uc3QgRXJyb3IgPSB0aGlzLmZpbmRPZlRoZVR5cGVFcnJvcihlcnJvcik7XHJcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XHJcbiAgICAgIGVycm9yOiBFcnJvcixcclxuICAgICAgaW5mbzogZXJyb3JJbmZvLFxyXG4gICAgfSkpO1xyXG4gICAgU2VudHJ5LndpdGhTY29wZShzY29wZSA9PiB7XHJcbiAgICAgIE9iamVjdC5rZXlzKGVycm9ySW5mbykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgIHNjb3BlLnNldEV4dHJhKGtleSwgZXJyb3JJbmZvW2tleV0pO1xyXG4gICAgICB9KTtcclxuICAgICAgU2VudHJ5LmNhcHR1cmVFeGNlcHRpb24oZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kT2ZUaGVUeXBlRXJyb3IoZXJyb3IpIHtcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluZGV4T2YoJ0dyYXBoUUwgZXJyb3I6ICcpID49IDApIHtcclxuICAgICAgcmV0dXJuIEdyYXBoUUxFcnJvcihlcnJvciwgdGhpcy5wcm9wcy50cmFuc2xhdGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5kZXhPZignTmV0d29yayBlcnJvcjogRmFpbGVkIHRvIGZldGNoJykgPj0gMCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG1lc3NhZ2U6ICdOZXR3b3JrIGVycm9yOiBGYWlsZWQgdG8gZmV0Y2gnLFxyXG4gICAgICAgIHJlZGlyZWN0OiAnLzUwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgICBjb25zdCB7Y2hpbGRyZW59ID0gdGhpcy5wcm9wcztcclxuICAgIGNvbnN0IHtlcnJvcn0gPSB0aGlzLnN0YXRlO1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGlmIChlcnJvci5yZWRpcmVjdCkge1xyXG4gICAgICAgIHJldHVybiA8UmVkaXJlY3QgdG89e2Vycm9yLnJlZGlyZWN0fS8+O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiA8ZGl2PlxyXG4gICAgICAgIDxSZW5kZXJFcnJvciB7Li4uZXJyb3J9IC8+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgfVxyXG4gICAgaWYgKCFjaGlsZHJlbikge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiBjaGlsZHJlbjtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEVycm9yQ2F0Y2g7XHJcbiJdfQ==