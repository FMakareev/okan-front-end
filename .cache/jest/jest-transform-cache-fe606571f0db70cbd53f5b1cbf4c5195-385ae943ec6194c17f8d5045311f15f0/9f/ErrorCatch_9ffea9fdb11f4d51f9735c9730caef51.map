{"version":3,"sources":["ErrorCatch.js"],"names":["ErrorCatch","props","state","error","findOfTheTypeError","bind","Sentry","withScope","scope","Object","keys","forEach","key","setExtra","captureException","setState","errorInfo","console","log","Error","info","message","indexOf","translate","redirect","children","Component","PropTypes","element","notifications","array"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport * as Sentry from '@sentry/browser';\r\nimport PropTypes from 'prop-types';\r\nimport {Redirect} from 'react-router-dom';\r\nimport GraphQLError from './GraphQLError';\r\nimport RenderError from '../RenderError/RenderError';\r\n\r\n/**\r\n * Компонент ошибки\r\n * @example ./ErrorCatch.example.md\r\n */\r\nexport class ErrorCatch extends Component {\r\n  static propTypes = {\r\n    /** Children component */\r\n    children: PropTypes.element,\r\n    /** notifications plugin: https://github.com/gor181/react-notification-system-redux */\r\n    notifications: PropTypes.array,\r\n  };\r\n\r\n  static defaultProps = {\r\n    error: null,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      error: null,\r\n    };\r\n    this.findOfTheTypeError = this.findOfTheTypeError.bind(this);\r\n    if (this.props.error) {\r\n      Sentry.withScope(scope => {\r\n        Object.keys(this.props.error).forEach(key => {\r\n          scope.setExtra(key, this.props.error[key]);\r\n        });\r\n        Sentry.captureException(this.props.error);\r\n      });\r\n      this.setState(() => ({\r\n        error: this.props.error,\r\n      }));\r\n    }\r\n  }\r\n\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    console.log(error, errorInfo);\r\n\r\n    const Error = this.findOfTheTypeError(error);\r\n    this.setState(() => ({\r\n      error: Error,\r\n      info: errorInfo,\r\n    }));\r\n    Sentry.withScope(scope => {\r\n      Object.keys(errorInfo).forEach(key => {\r\n        scope.setExtra(key, errorInfo[key]);\r\n      });\r\n      Sentry.captureException(error);\r\n    });\r\n  }\r\n\r\n  findOfTheTypeError(error) {\r\n    if (error.message.indexOf('GraphQL error: ') >= 0) {\r\n      return GraphQLError(error, this.props.translate);\r\n    }\r\n    if (error.message.indexOf('Network error: Failed to fetch') >= 0) {\r\n      return {\r\n        message: 'Network error: Failed to fetch',\r\n        redirect: '/500',\r\n      };\r\n    }\r\n    return error;\r\n  }\r\n\r\n  render() {\r\n    const {children} = this.props;\r\n    const {error} = this.state;\r\n    if (error) {\r\n      if (error.redirect) {\r\n        return <Redirect to={error.redirect}/>;\r\n      }\r\n      return <div>\r\n        <RenderError {...error} />\r\n      </div>\r\n    }\r\n    if (!children) {\r\n      return null;\r\n    }\r\n    return children;\r\n  }\r\n}\r\n\r\nexport default ErrorCatch;\r\n"]}